<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>evalla Home</title><meta name="description" content="Safe math evaluator with variables, dependencies, and precision"><meta property="og:title" content="evalla Home"><meta property="og:description" content="Safe math evaluator with variables, dependencies, and precision"><meta property="og:type" content="website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Borel&display=swap" rel="stylesheet"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/evalla/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CDGfc0hd.js"></script><link rel="stylesheet" href="/evalla/_astro/index.BByAEq9k.css"></head> <body class="min-h-screen bg-white"> <header class="max-w-5xl mx-auto px-4 sm:px-8 lg:px-12 pt-6 pb-4"> <div class="flex items-baseline justify-between flex-wrap gap-3"> <div class="flex items-baseline gap-3"> <a href="#" class="font-borel text-2xl sm:text-3xl font-bold text-blue-600 hover:text-blue-700 transition-colors no-underline">
evalla
</a> </div> <nav class="flex items-baseline gap-2 sm:gap-3">  <a href="./playground" class="px-3 py-1.5 text-sm text-gray-600 hover:text-blue-600 transition-colors">
Playground
</a> <a href="https://github.com/danmarshall/evalla" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 text-sm text-gray-600 hover:text-blue-600 transition-colors inline-flex items-baseline gap-1.5" aria-label="GitHub"> <svg class="w-4 h-4 translate-y-0.5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"> <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path> </svg> <span class="hidden sm:inline">GitHub</span> </a> </nav> </div> <p class="text-gray-500 text-[0.9375rem]">Safe math evaluator with variables, dependencies, and precision.</p> </header> <main class="max-w-5xl mx-auto px-4 sm:px-8 lg:px-12 pb-6"> <div class="content"> <h1 id="evalla">evalla</h1>
<p>Safe math evaluator with variables, dependencies, and precision.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { evalla } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'evalla'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'a'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'c + 5'</span><span style="color:#24292E"> },          </span><span style="color:#6A737D">// depends on c</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'b'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'a * 2'</span><span style="color:#24292E"> },          </span><span style="color:#6A737D">// depends on a</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'c'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'1 + 1'</span><span style="color:#24292E"> }           </span><span style="color:#6A737D">// base constant</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.a.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "7"</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.b.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "14"</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.c.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "2"</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.order);               </span><span style="color:#6A737D">// ['c', 'a', 'b']</span></span></code></pre>
<h2 id="features">Features</h2>
<ul>
<li>✅ <strong>Decimal Precision</strong>: Uses <a href="https://mikemcl.github.io/decimal.js/">decimal.js</a> internally for accurate arithmetic</li>
<li>✅ <strong>Decimal, Boolean &#x26; Null Output</strong>: Results can be <code>Decimal</code>, <code>boolean</code>, or <code>null</code> for natural mathematical expressions</li>
<li>✅ <strong>Variable References</strong>: Support dependencies between expressions</li>
<li>✅ <strong>Dot-Traversal</strong>: Reference nested properties (e.g., <code>point.x</code>, <code>offset.y</code>)</li>
<li>✅ <strong>Topological Ordering</strong>: Evaluates in correct dependency order (DAG)</li>
<li>✅ <strong>Circular Detection</strong>: Throws error on circular dependencies</li>
<li>✅ <strong>Safe Evaluation</strong>: Parses with <a href="https://peggyjs.org/">Peggy</a> parser, evaluates AST (no <code>eval()</code> or <code>Function()</code>)</li>
<li>✅ <strong>Keywords as Variables</strong>: Unlike JavaScript, keywords like <code>return</code>, <code>if</code>, etc. can be used as variable names</li>
<li>✅ <a href="#namespaces"><strong>Namespaces</strong></a>: Built-in <code>$math</code>, <code>$unit</code>, and <code>$angle</code> functions</li>
</ul>
<h2 id="installation">Installation</h2>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> install</span><span style="color:#032F62"> evalla</span></span></code></pre>
<h2 id="usage">Usage</h2>
<h3 id="input-format">Input Format</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">interface</span><span style="color:#6F42C1"> ExpressionInput</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#E36209">  name</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span><span style="color:#24292E">;         </span><span style="color:#6A737D">// Variable name (cannot start with $)</span></span>
<span class="line"><span style="color:#E36209">  expr</span><span style="color:#D73A49">?:</span><span style="color:#005CC5"> string</span><span style="color:#24292E">;        </span><span style="color:#6A737D">// Math expression (optional if value is provided)</span></span>
<span class="line"><span style="color:#E36209">  value</span><span style="color:#D73A49">?:</span><span style="color:#005CC5"> any</span><span style="color:#24292E">;          </span><span style="color:#6A737D">// Direct value (optional if expr is provided)</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>You must provide either <code>expr</code> or <code>value</code> per item. The <code>value</code> property allows you to pass objects and arrays directly without stringifying them into expressions.</p>
<p><strong>Important Type Restrictions:</strong></p>
<ul>
<li><strong>Objects and arrays can ONLY be provided via <code>value</code> property</strong></li>
<li>Expressions cannot create or return objects/arrays (only <code>Decimal</code>, <code>boolean</code>, or <code>null</code>)</li>
<li>Objects/arrays from <code>value</code> are stored in context for property access but <strong>not included in output values</strong></li>
<li>This ensures clean output types: <code>Record&#x3C;string, Decimal | boolean | null></code></li>
</ul>
<p><strong>Using expressions:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'width'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'100'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'height'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'50'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span></code></pre>
<p><strong>Using direct values:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'point'</span><span style="color:#24292E">, value: { x: </span><span style="color:#005CC5">10</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">20</span><span style="color:#24292E"> } },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'offset'</span><span style="color:#24292E">, value: { x: </span><span style="color:#005CC5">5</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">10</span><span style="color:#24292E"> } }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span></code></pre>
<p><strong>Mixing both:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'data'</span><span style="color:#24292E">, value: { width: </span><span style="color:#005CC5">100</span><span style="color:#24292E">, height: </span><span style="color:#005CC5">50</span><span style="color:#24292E"> } },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'area'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'data.width * data.height'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span></code></pre>
<h3 id="output-format">Output Format</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">interface</span><span style="color:#6F42C1"> EvaluationResult</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#E36209">  values</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Record</span><span style="color:#24292E">&#x3C;</span><span style="color:#005CC5">string</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Decimal</span><span style="color:#D73A49"> |</span><span style="color:#005CC5"> boolean</span><span style="color:#D73A49"> |</span><span style="color:#005CC5"> null</span><span style="color:#24292E">>;  </span><span style="color:#6A737D">// Computed values</span></span>
<span class="line"><span style="color:#E36209">  order</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span><span style="color:#24292E">[];                                   </span><span style="color:#6A737D">// Evaluation order (topologically sorted)</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>Results can be:</p>
<ul>
<li><strong>Decimal</strong>: Numeric values with arbitrary precision</li>
<li><strong>boolean</strong>: Results from comparisons (<code>a > b</code>) or boolean literals (<code>true</code>, <code>false</code>)</li>
<li><strong>null</strong>: The null literal or null branches in ternary expressions</li>
</ul>
<h2 id="examples">Examples</h2>
<h3 id="basic-arithmetic-with-precision">Basic Arithmetic with Precision</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'x'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'0.1 + 0.2'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.x.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "0.3" (exact!)</span></span></code></pre>
<h3 id="variable-dependencies">Variable Dependencies</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'d'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'c * 2'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'b'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'a + 10'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'c'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'b * 3'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'a'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'5'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Automatically orders: a, b, c, d</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.order); </span><span style="color:#6A737D">// ['a', 'b', 'c', 'd']</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.d.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "90"</span></span></code></pre>
<h3 id="arrays-and-objects-via-value-property">Arrays and Objects (via value property)</h3>
<p><strong>Important</strong>: Arrays and objects can ONLY be supplied via the <code>value</code> property. They cannot be created in expressions.</p>
<p>Arrays passed via <code>value</code> can be accessed with computed property syntax:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'data'</span><span style="color:#24292E">, value: [</span><span style="color:#005CC5">10</span><span style="color:#24292E">, </span><span style="color:#005CC5">20</span><span style="color:#24292E">, </span><span style="color:#005CC5">30</span><span style="color:#24292E">, </span><span style="color:#005CC5">40</span><span style="color:#24292E">, </span><span style="color:#005CC5">50</span><span style="color:#24292E">] },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'first'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'data[0]'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'sum'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'data[0] + data[1] + data[2]'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.first.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "10"</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.sum.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">());   </span><span style="color:#6A737D">// "60"</span></span>
<span class="line"><span style="color:#6A737D">// Note: result.values.data is undefined (arrays from value property are not in output)</span></span></code></pre>
<h3 id="object-property-access-via-value-property">Object Property Access (via value property)</h3>
<p>Objects must be passed via the <code>value</code> property, then accessed with dot notation:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'point'</span><span style="color:#24292E">, value: {x: </span><span style="color:#005CC5">10</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">20</span><span style="color:#24292E">} },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'offset'</span><span style="color:#24292E">, value: {x: </span><span style="color:#005CC5">5</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">10</span><span style="color:#24292E">} },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'resultX'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'point.x + offset.x'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'resultY'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'point.y + offset.y'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.resultX.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "15"</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.resultY.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "30"</span></span>
<span class="line"><span style="color:#6A737D">// Note: result.values.point and result.values.offset are undefined (objects from value property are not in output)</span></span></code></pre>
<p><strong>Special Property Names</strong>: Use string literals in computed property access for property names with special characters:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'obj'</span><span style="color:#24292E">, value: { </span><span style="color:#032F62">'y-y'</span><span style="color:#24292E">: </span><span style="color:#005CC5">20</span><span style="color:#24292E">, </span><span style="color:#032F62">'prop name'</span><span style="color:#24292E">: </span><span style="color:#005CC5">42</span><span style="color:#24292E"> } },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'hyphen'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'obj["y-y"]'</span><span style="color:#24292E"> },      </span><span style="color:#6A737D">// String literal for hyphenated property</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'space'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'obj["prop name"]'</span><span style="color:#24292E"> }  </span><span style="color:#6A737D">// String literal for property with space</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.hyphen.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "20"</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.space.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">());  </span><span style="color:#6A737D">// "42"</span></span></code></pre>
<p><strong>Note:</strong> Objects and arrays cannot be created within expressions. Use the <code>value</code> property to pass them, then access properties/elements in expressions.</p>
<h3 id="nested-property-access">Nested Property Access</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'data'</span><span style="color:#24292E">, value: {pos: {x: </span><span style="color:#005CC5">5</span><span style="color:#24292E">, y: </span><span style="color:#005CC5">10</span><span style="color:#24292E">}, scale: </span><span style="color:#005CC5">2</span><span style="color:#24292E">} },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'scaledX'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'data.pos.x * data.scale'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.scaledX.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "10"</span></span></code></pre>
<h2 id="reserved-values">Reserved Values</h2>
<p><strong>Algebra, not code:</strong> evalla is designed for natural mathematical expressions, not programming. A few special values are reserved as first-class mathematical primitives and cannot be used as variable names:</p>
<ul>
<li><code>true</code> - Boolean true value</li>
<li><code>false</code> - Boolean false value</li>
<li><code>null</code> - Null value (for missing/undefined results)</li>
<li><code>Infinity</code> - Mathematical infinity</li>
</ul>
<p>These reserved values allow evalla to return boolean results from comparisons and handle edge cases naturally, just like in mathematical notation.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// ❌ Cannot use reserved values as variable names</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'true'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'10'</span><span style="color:#24292E"> }]);     </span><span style="color:#6A737D">// ValidationError</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'false'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'10'</span><span style="color:#24292E"> }]);    </span><span style="color:#6A737D">// ValidationError</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'null'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'10'</span><span style="color:#24292E"> }]);     </span><span style="color:#6A737D">// ValidationError</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'Infinity'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'10'</span><span style="color:#24292E"> }]); </span><span style="color:#6A737D">// ValidationError</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ✅ Can use them as values</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'isValid'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'true'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'isEmpty'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'false'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'missing'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'null'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span></code></pre>
<p><strong>Why reserve these?</strong> Unlike programming keywords (which evalla allows as variable names), these mathematical primitives need special handling to support boolean logic and comparisons as first-class results.</p>
<h2 id="boolean-output">Boolean Output</h2>
<p>Results can now be boolean values, not just numbers. This enables natural mathematical questions:</p>
<h3 id="standalone-comparisons">Standalone Comparisons</h3>
<p>Comparisons return <code>true</code> or <code>false</code>:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'slope'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'0.75'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'isSteep'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'slope > 0.5'</span><span style="color:#24292E"> }  </span><span style="color:#6A737D">// Returns boolean true</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.isSteep); </span><span style="color:#6A737D">// true</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(</span><span style="color:#D73A49">typeof</span><span style="color:#24292E"> result.values.isSteep); </span><span style="color:#6A737D">// "boolean"</span></span></code></pre>
<p>All comparison operators return boolean:</p>
<ul>
<li><code>&#x3C;</code>, <code>></code>, <code>&#x3C;=</code>, <code>>=</code> - Numeric comparisons</li>
<li><code>=</code>, <code>==</code> - Equality (both work the same)</li>
<li><code>!=</code> - Inequality</li>
<li><code>&#x26;&#x26;</code>, <code>||</code>, <code>!</code> - Logical operators</li>
</ul>
<h3 id="boolean-branches-in-ternary">Boolean Branches in Ternary</h3>
<p>Ternary expressions can have boolean or null branches:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'score'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'85'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'passed'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'score >= 60 ? true : false'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'bonus'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'score >= 90 ? 10 : null'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.passed);  </span><span style="color:#6A737D">// true (boolean)</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.bonus);   </span><span style="color:#6A737D">// null</span></span></code></pre>
<h3 id="boolean-literals">Boolean Literals</h3>
<p>Use <code>true</code> and <code>false</code> directly:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'enabled'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'true'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'disabled'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'false'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'result'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'enabled &#x26;&#x26; !disabled'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.result); </span><span style="color:#6A737D">// true</span></span></code></pre>
<h2 id="equality-operators">Equality Operators</h2>
<p>evalla supports two equality operators that work identically:</p>
<h3 id="single-equals--algebraic">Single Equals <code>=</code> (Algebraic)</h3>
<p>In mathematics, <code>=</code> tests equality. evalla follows this convention:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'x'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'5'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'y'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'5'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'equal'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'x = y'</span><span style="color:#24292E"> }  </span><span style="color:#6A737D">// Algebraic equality</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.equal); </span><span style="color:#6A737D">// true</span></span></code></pre>
<h3 id="double-equals--programmer-friendly">Double Equals <code>==</code> (Programmer-Friendly)</h3>
<p>For programmers familiar with <code>==</code>, it works exactly the same:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'a'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'10'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'b'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'20'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'test'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'(a + 10) == b'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.test); </span><span style="color:#6A737D">// true</span></span></code></pre>
<p><strong>No loose vs. strict:</strong> Unlike JavaScript, there’s no distinction between <code>=</code> and <code>==</code> in evalla. Both <code>=</code> and <code>==</code> perform the same strict equality check. Use whichever feels more natural.</p>
<h2 id="namespaces">Namespaces</h2>
<p>Variables may not begin with $, this is reserved for namespaces for built-in functions and constants.</p>
<h4 id="math-namespace">$math Namespace</h4>
<p>Mathematical constants and functions:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'circumference'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'2 * $math.PI * 10'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'absVal'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math.abs(-42)'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'sqrtVal'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math.sqrt(16)'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'maxVal'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math.max(10, 5, 20, 3)'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span></code></pre>
<p><strong>Available:</strong></p>
<ul>
<li>Constants: <code>PI</code>, <code>E</code>, <code>SQRT2</code>, <code>SQRT1_2</code>, <code>LN2</code>, <code>LN10</code>, <code>LOG2E</code>, <code>LOG10E</code></li>
<li>Functions: <code>abs</code>, <code>sqrt</code>, <code>cbrt</code>, <code>floor</code>, <code>ceil</code>, <code>round</code>, <code>trunc</code>, <code>sin</code>, <code>cos</code>, <code>tan</code>, <code>asin</code>, <code>acos</code>, <code>atan</code>, <code>atan2</code>, <code>exp</code>, <code>ln</code>, <code>log</code>, <code>log10</code>, <code>log2</code>, <code>pow</code>, <code>min</code>, <code>max</code></li>
</ul>
<h4 id="unit-namespace">$unit Namespace</h4>
<p>Unit conversion functions:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'inches'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$unit.mmToInch(25.4)'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'mm'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$unit.inchToMm(1)'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span></code></pre>
<p><strong>Available:</strong></p>
<ul>
<li><code>mmToInch</code>, <code>inchToMm</code></li>
<li><code>cmToInch</code>, <code>inchToCm</code></li>
<li><code>mToFt</code>, <code>ftToM</code></li>
</ul>
<h4 id="angle-namespace">$angle Namespace</h4>
<p>Angle conversion functions:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'radians'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$angle.toRad(180)'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'degrees'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$angle.toDeg($math.PI)'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span></code></pre>
<p><strong>Available:</strong></p>
<ul>
<li><code>toRad</code> (degrees to radians)</li>
<li><code>toDeg</code> (radians to degrees)</li>
</ul>
<h2 id="circular-dependency-detection">Circular Dependency Detection</h2>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">try</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">    { name: </span><span style="color:#032F62">'a'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'b + 1'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">    { name: </span><span style="color:#032F62">'b'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'a + 1'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">  ]);</span></span>
<span class="line"><span style="color:#24292E">} </span><span style="color:#D73A49">catch</span><span style="color:#24292E"> (error) {</span></span>
<span class="line"><span style="color:#24292E">  console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(error.message); </span><span style="color:#6A737D">// "Circular dependency detected: b -> a -> b"</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="variable-naming">Variable naming</h2>
<p>Variables may not begin with a number, double underscore(__), or $ (see namespaces above).</p>
<p>Variables cannot use reserved values: <code>true</code>, <code>false</code>, <code>null</code>, <code>Infinity</code> (see <a href="#reserved-values">Reserved Values</a>).</p>
<h4 id="keywords-as-variable-names">Keywords as Variable Names</h4>
<p>Unlike JavaScript, algebra-like variable names can include JavaScript keywords:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'return'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'10'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'if'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'20'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'for'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'return + if'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result.values.for.</span><span style="color:#6F42C1">toString</span><span style="color:#24292E">()); </span><span style="color:#6A737D">// "30"</span></span></code></pre>
<h2 id="security">Security</h2>
<p><strong>Safe by design:</strong></p>
<ul>
<li>❌ No access to <code>eval()</code>, <code>Function()</code>, or other dangerous globals</li>
<li>❌ No access to <code>process</code>, <code>require</code>, or Node.js internals</li>
<li>❌ No access to dangerous properties: <code>prototype</code>, <code>__proto__</code>, <code>constructor</code>, or any property starting with <code>__</code></li>
<li>❌ No function aliasing - namespace functions must be called, not assigned to variables</li>
<li>✅ Only whitelisted functions in namespaces</li>
<li>✅ Uses AST parsing (Peggy) + safe evaluation</li>
<li>✅ Variable names cannot start with <code>$</code> (reserved for system)</li>
<li>✅ Sandboxed scope with <code>Object.create(null)</code></li>
<li>✅ No prototype pollution</li>
</ul>
<p><strong>Blocked property access examples:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// These will throw SecurityError</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'bad'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'obj.prototype'</span><span style="color:#24292E"> }]);</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'bad'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'obj.__proto__'</span><span style="color:#24292E"> }]);</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'bad'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'obj.constructor'</span><span style="color:#24292E"> }]);</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'bad'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'obj.__defineGetter__'</span><span style="color:#24292E"> }]);</span></span></code></pre>
<p><strong>Blocked function aliasing examples:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// These will throw SecurityError - functions must be called with ()</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'myabs'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math.abs'</span><span style="color:#24292E"> }]);</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'mysqrt'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math.sqrt'</span><span style="color:#24292E"> }]);</span></span>
<span class="line"><span style="color:#6A737D">// Correct usage - call the function:</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'result'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math.abs(-5)'</span><span style="color:#24292E"> }]); </span><span style="color:#6A737D">// ✅ Works</span></span></code></pre>
<p><strong>Blocked namespace head usage:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// Namespace heads cannot be used as standalone values</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'a'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math'</span><span style="color:#24292E"> }]); </span><span style="color:#6A737D">// ❌ EvaluationError</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'a'</span><span style="color:#24292E">, value: </span><span style="color:#005CC5">5</span><span style="color:#24292E"> }, { name: </span><span style="color:#032F62">'b'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'a &#x3C; $angle'</span><span style="color:#24292E"> }]); </span><span style="color:#6A737D">// ❌ EvaluationError</span></span>
<span class="line"><span style="color:#6A737D">// Correct usage - access properties or call methods:</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'pi'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$math.PI'</span><span style="color:#24292E"> }]); </span><span style="color:#6A737D">// ✅ Works</span></span>
<span class="line"><span style="color:#D73A49">await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">([{ name: </span><span style="color:#032F62">'rad'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'$angle.toRad(180)'</span><span style="color:#24292E"> }]); </span><span style="color:#6A737D">// ✅ Works</span></span></code></pre>
<p>Properties starting with <code>__</code> are blocked because they typically provide access to JavaScript internals that could be exploited for prototype pollution or other security vulnerabilities.</p>
<h2 id="api">API</h2>
<h3 id="evallainputs-expressioninput-promiseevaluationresult"><code>evalla(inputs: ExpressionInput[]): Promise&#x3C;EvaluationResult></code></h3>
<p>Evaluates an array of math expressions with dependencies.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>inputs</code>: Array of <code>{ name, expr }</code> objects</li>
</ul>
<p><strong>Returns:</strong></p>
<ul>
<li>Promise resolving to <code>{ values, order }</code></li>
</ul>
<p><strong>Throws:</strong></p>
<ul>
<li><code>ValidationError</code> - Invalid input (missing name, duplicate names, invalid variable names)
<ul>
<li>Properties: <code>variableName</code></li>
</ul>
</li>
<li><code>CircularDependencyError</code> - Circular dependencies detected
<ul>
<li>Properties: <code>cycle</code> (array of variable names in the cycle)</li>
</ul>
</li>
<li><code>ParseError</code> - Syntax/parsing errors in expressions (extends <code>EvaluationError</code>)
<ul>
<li>Properties: <code>variableName</code>, <code>expression</code>, <code>line</code>, <code>column</code></li>
</ul>
</li>
<li><code>EvaluationError</code> - Runtime evaluation errors (undefined variables, type errors)
<ul>
<li>Properties: <code>variableName</code></li>
</ul>
</li>
<li><code>SecurityError</code> - Attempt to access blocked properties (prototype, <strong>proto</strong>, constructor, __*)
<ul>
<li>Properties: <code>property</code></li>
</ul>
</li>
</ul>
<p>All errors include structured details for programmatic access - no need to parse error messages!</p>
<p><strong>Error Handling:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { evalla, ParseError, SecurityError, CircularDependencyError, ValidationError, EvaluationError } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'evalla'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">try</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">(inputs);</span></span>
<span class="line"><span style="color:#24292E">} </span><span style="color:#D73A49">catch</span><span style="color:#24292E"> (error) {</span></span>
<span class="line"><span style="color:#6A737D">  // Catch ParseError first since it extends EvaluationError</span></span>
<span class="line"><span style="color:#D73A49">  if</span><span style="color:#24292E"> (error </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> ParseError</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Syntax error in "${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">variableName</span><span style="color:#032F62">}" at ${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">line</span><span style="color:#032F62">}:${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">column</span><span style="color:#032F62">}`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Expression: ${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">expression</span><span style="color:#032F62">}`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (error </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> EvaluationError</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Runtime error in "${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">variableName</span><span style="color:#032F62">}"`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (error </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> SecurityError</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Security violation: attempted to access "${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">property</span><span style="color:#032F62">}"`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (error </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> CircularDependencyError</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Circular dependency: ${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">cycle</span><span style="color:#032F62">.</span><span style="color:#6F42C1">join</span><span style="color:#032F62">(</span><span style="color:#032F62">' -> '</span><span style="color:#032F62">)</span><span style="color:#032F62">}`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (error </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> ValidationError</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Invalid variable: "${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">variableName</span><span style="color:#032F62">}"`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="checksyntaxexpr-string-syntaxcheckresult"><code>checkSyntax(expr: string): SyntaxCheckResult</code></h3>
<p>Checks the syntax of an expression without evaluating it. Useful for text editors to validate expressions before sending them for evaluation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>expr</code>: The expression string to check</li>
</ul>
<p><strong>Returns:</strong></p>
<ul>
<li>Object with the following properties:
<ul>
<li><code>valid</code>: boolean - Whether the syntax is valid</li>
<li><code>error?</code>: string - Error message if syntax is invalid</li>
<li><code>line?</code>: number - Line number where error occurred (1-indexed)</li>
<li><code>column?</code>: number - Column number where error occurred (1-indexed)</li>
</ul>
</li>
</ul>
<p><strong>Example:</strong></p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { checkSyntax } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'evalla'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Valid expression</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result1</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> checkSyntax</span><span style="color:#24292E">(</span><span style="color:#032F62">'a + b * 2'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result1.valid); </span><span style="color:#6A737D">// true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Invalid expression - missing closing parenthesis</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result2</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> checkSyntax</span><span style="color:#24292E">(</span><span style="color:#032F62">'(a + b'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result2.valid); </span><span style="color:#6A737D">// false</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result2.error); </span><span style="color:#6A737D">// "Parse error at line 1, column 7: Expected..."</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result2.line); </span><span style="color:#6A737D">// 1</span></span>
<span class="line"><span style="color:#24292E">console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(result2.column); </span><span style="color:#6A737D">// 7</span></span></code></pre>
<p><strong>Usage Patterns:</strong></p>
<p>When to use <code>checkSyntax()</code> vs just calling <code>evalla()</code>:</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { checkSyntax, evalla, EvaluationError } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'evalla'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Pattern 1: Pre-validate for immediate user feedback (recommended for text editors/UI)</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> inputs</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'a'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'c + 5'</span><span style="color:#24292E"> },</span></span>
<span class="line"><span style="color:#24292E">  { name: </span><span style="color:#032F62">'b'</span><span style="color:#24292E">, expr: </span><span style="color:#032F62">'a * 2'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Check syntax of each expression before calling evalla</span></span>
<span class="line"><span style="color:#D73A49">for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">const</span><span style="color:#005CC5"> input</span><span style="color:#D73A49"> of</span><span style="color:#24292E"> inputs) {</span></span>
<span class="line"><span style="color:#D73A49">  if</span><span style="color:#24292E"> (input.expr) {</span></span>
<span class="line"><span style="color:#D73A49">    const</span><span style="color:#005CC5"> check</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> checkSyntax</span><span style="color:#24292E">(input.expr);</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#24292E">check.valid) {</span></span>
<span class="line"><span style="color:#24292E">      console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Invalid syntax in "${</span><span style="color:#24292E">input</span><span style="color:#032F62">.</span><span style="color:#24292E">name</span><span style="color:#032F62">}": ${</span><span style="color:#24292E">check</span><span style="color:#032F62">.</span><span style="color:#24292E">error</span><span style="color:#032F62">}`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">      return</span><span style="color:#24292E">; </span><span style="color:#6A737D">// Don't call evalla with invalid syntax</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// All syntax valid, now evaluate</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">(inputs);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Pattern 2: Let evalla handle all validation (simpler for batch processing)</span></span>
<span class="line"><span style="color:#D73A49">try</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> evalla</span><span style="color:#24292E">(inputs);</span></span>
<span class="line"><span style="color:#6A737D">  // Success - use result</span></span>
<span class="line"><span style="color:#24292E">} </span><span style="color:#D73A49">catch</span><span style="color:#24292E"> (error) {</span></span>
<span class="line"><span style="color:#6A737D">  // Catch ParseError specifically to handle syntax errors</span></span>
<span class="line"><span style="color:#D73A49">  if</span><span style="color:#24292E"> (error </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> ParseError</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">`Syntax error in "${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">variableName</span><span style="color:#032F62">}" at ${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">line</span><span style="color:#032F62">}:${</span><span style="color:#24292E">error</span><span style="color:#032F62">.</span><span style="color:#24292E">column</span><span style="color:#032F62">}`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (error </span><span style="color:#D73A49">instanceof</span><span style="color:#6F42C1"> EvaluationError</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span><span style="color:#032F62">'Runtime evaluation error:'</span><span style="color:#24292E">, error.message);</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#6A737D">  // Handle other error types (ValidationError, CircularDependencyError, etc.)</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p><strong>Note:</strong></p>
<ul>
<li><code>checkSyntax()</code> only validates expression syntax. It does not check variable names, detect circular dependencies, or validate that referenced variables exist.</li>
<li><code>evalla()</code> throws <code>ParseError</code> for syntax errors with the same details (line, column, message) as <code>checkSyntax()</code>, plus identifies which variable has the error.</li>
<li><code>ParseError</code> extends <code>EvaluationError</code>, so catch <code>ParseError</code> first if you want to handle syntax errors differently from runtime errors.</li>
<li>Use <code>checkSyntax()</code> for pre-flight validation (e.g., real-time feedback as user types). Use <code>evalla()</code> for complete validation and evaluation.</li>
</ul>
<h2 id="philosophy">Philosophy</h2>
<ul>
<li><strong>Minimal</strong>: Bare minimum dependencies and code</li>
<li><strong>Modular</strong>: Separated concerns (parser, evaluator, namespaces, toposort)</li>
<li><strong>DRY</strong>: No code duplication</li>
<li><strong>Testable</strong>: Small, focused functions with clear interfaces</li>
<li><strong>Safe &#x26; Secure</strong>: No arbitrary code execution, whitelist-only approach</li>
<li><strong>Efficient</strong>: Parse once, use for both dependency extraction and evaluation</li>
</ul>
<h2 id="development">Development</h2>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Install dependencies</span></span>
<span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Build</span></span>
<span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> run</span><span style="color:#032F62"> build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Test</span></span>
<span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> test</span></span></code></pre>
<p>For detailed API documentation and examples, see the sections above.</p>
<h2 id="license">License</h2>
<p>MIT</p> </div> </main> <footer class="border-t border-gray-200 text-gray-600 text-sm px-4 py-4"> <div class="flex flex-col items-center gap-2"> <div class="flex items-center gap-4"> <a href="https://github.com/danmarshall/evalla" target="_blank" rel="noopener noreferrer" class="hover:text-blue-600 transition-colors"> <span class="font-borel">evalla</span> GitHub
</a> </div> </div> </footer> </body></html>