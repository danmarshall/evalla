/*!
 *  decimal.js v10.6.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var Ne=9e15,pe=1e9,Ke="0123456789abcdef",qe="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ie="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ye={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ne,maxE:Ne,crypto:!1},qt,oe,k=!0,De="[DecimalError] ",ue=De+"Invalid argument: ",It=De+"Precision limit exceeded",_t=De+"crypto unavailable",Dt="[object Decimal]",W=Math.floor,U=Math.pow,Mr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Pr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,xr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Rt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,K=1e7,x=7,Or=9007199254740991,kr=qe.length-1,et=Ie.length-1,E={toStringTag:Dt};E.absoluteValue=E.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),S(e)};E.ceil=function(){return S(new this.constructor(this),this.e+1,2)};E.clampedTo=E.clamp=function(e,r){var t,n=this,i=n.constructor;if(e=new i(e),r=new i(r),!e.s||!r.s)return new i(NaN);if(e.gt(r))throw Error(ue+r);return t=n.cmp(e),t<0?e:n.cmp(r)>0?r:new i(n)};E.comparedTo=E.cmp=function(e){var r,t,n,i,s=this,o=s.d,a=(e=new s.constructor(e)).d,l=s.s,c=e.s;if(!o||!a)return!l||!c?NaN:l!==c?l:o===a?0:!o^l<0?1:-1;if(!o[0]||!a[0])return o[0]?l:a[0]?-c:0;if(l!==c)return l;if(s.e!==e.e)return s.e>e.e^l<0?1:-1;for(n=o.length,i=a.length,r=0,t=n<i?n:i;r<t;++r)if(o[r]!==a[r])return o[r]>a[r]^l<0?1:-1;return n===i?0:n>i^l<0?1:-1};E.cosine=E.cos=function(){var e,r,t=this,n=t.constructor;return t.d?t.d[0]?(e=n.precision,r=n.rounding,n.precision=e+Math.max(t.e,t.sd())+x,n.rounding=1,t=Lr(n,Bt(n,t)),n.precision=e,n.rounding=r,S(oe==2||oe==3?t.neg():t,e,r,!0)):new n(1):new n(NaN)};E.cubeRoot=E.cbrt=function(){var e,r,t,n,i,s,o,a,l,c,h=this,w=h.constructor;if(!h.isFinite()||h.isZero())return new w(h);for(k=!1,s=h.s*U(h.s*h,1/3),!s||Math.abs(s)==1/0?(t=V(h.d),e=h.e,(s=(e-t.length+1)%3)&&(t+=s==1||s==-2?"0":"00"),s=U(t,1/3),e=W((e+1)/3)-(e%3==(e<0?-1:2)),s==1/0?t="5e"+e:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new w(t),n.s=h.s):n=new w(s.toString()),o=(e=w.precision)+3;;)if(a=n,l=a.times(a).times(a),c=l.plus(h),n=D(c.plus(h).times(a),c.plus(l),o+2,1),V(a.d).slice(0,o)===(t=V(n.d)).slice(0,o))if(t=t.slice(o-3,o+1),t=="9999"||!i&&t=="4999"){if(!i&&(S(a,e+1,0),a.times(a).times(a).eq(h))){n=a;break}o+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(S(n,e+1,1),r=!n.times(n).times(n).eq(h));break}return k=!0,S(n,e,w.rounding,r)};E.decimalPlaces=E.dp=function(){var e,r=this.d,t=NaN;if(r){if(e=r.length-1,t=(e-W(this.e/x))*x,e=r[e],e)for(;e%10==0;e/=10)t--;t<0&&(t=0)}return t};E.dividedBy=E.div=function(e){return D(this,new this.constructor(e))};E.dividedToIntegerBy=E.divToInt=function(e){var r=this,t=r.constructor;return S(D(r,new t(e),0,1,1),t.precision,t.rounding)};E.equals=E.eq=function(e){return this.cmp(e)===0};E.floor=function(){return S(new this.constructor(this),this.e+1,3)};E.greaterThan=E.gt=function(e){return this.cmp(e)>0};E.greaterThanOrEqualTo=E.gte=function(e){var r=this.cmp(e);return r==1||r===0};E.hyperbolicCosine=E.cosh=function(){var e,r,t,n,i,s=this,o=s.constructor,a=new o(1);if(!s.isFinite())return new o(s.s?1/0:NaN);if(s.isZero())return a;t=o.precision,n=o.rounding,o.precision=t+Math.max(s.e,s.sd())+4,o.rounding=1,i=s.d.length,i<32?(e=Math.ceil(i/3),r=(1/je(4,e)).toString()):(e=16,r="2.3283064365386962890625e-10"),s=ye(o,1,s.times(r),new o(1),!0);for(var l,c=e,h=new o(8);c--;)l=s.times(s),s=a.minus(l.times(h.minus(l.times(h))));return S(s,o.precision=t,o.rounding=n,!0)};E.hyperbolicSine=E.sinh=function(){var e,r,t,n,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(r=s.precision,t=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,n=i.d.length,n<3)i=ye(s,2,i,i,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,i=i.times(1/je(5,e)),i=ye(s,2,i,i,!0);for(var o,a=new s(5),l=new s(16),c=new s(20);e--;)o=i.times(i),i=i.times(a.plus(o.times(l.times(o).plus(c))))}return s.precision=r,s.rounding=t,S(i,r,t,!0)};E.hyperbolicTangent=E.tanh=function(){var e,r,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(e=n.precision,r=n.rounding,n.precision=e+7,n.rounding=1,D(t.sinh(),t.cosh(),n.precision=e,n.rounding=r)):new n(t.s)};E.inverseCosine=E.acos=function(){var e=this,r=e.constructor,t=e.abs().cmp(1),n=r.precision,i=r.rounding;return t!==-1?t===0?e.isNeg()?ee(r,n,i):new r(0):new r(NaN):e.isZero()?ee(r,n+4,i).times(.5):(r.precision=n+6,r.rounding=1,e=new r(1).minus(e).div(e.plus(1)).sqrt().atan(),r.precision=n,r.rounding=i,e.times(2))};E.inverseHyperbolicCosine=E.acosh=function(){var e,r,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(e=n.precision,r=n.rounding,n.precision=e+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,k=!1,t=t.times(t).minus(1).sqrt().plus(t),k=!0,n.precision=e,n.rounding=r,t.ln()):new n(t)};E.inverseHyperbolicSine=E.asinh=function(){var e,r,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(e=n.precision,r=n.rounding,n.precision=e+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,k=!1,t=t.times(t).plus(1).sqrt().plus(t),k=!0,n.precision=e,n.rounding=r,t.ln())};E.inverseHyperbolicTangent=E.atanh=function(){var e,r,t,n,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=s.precision,r=s.rounding,n=i.sd(),Math.max(n,e)<2*-i.e-1?S(new s(i),e,r,!0):(s.precision=t=n-i.e,i=D(i.plus(1),new s(1).minus(i),t+e,1),s.precision=e+4,s.rounding=1,i=i.ln(),s.precision=e,s.rounding=r,i.times(.5))):new s(NaN)};E.inverseSine=E.asin=function(){var e,r,t,n,i=this,s=i.constructor;return i.isZero()?new s(i):(r=i.abs().cmp(1),t=s.precision,n=s.rounding,r!==-1?r===0?(e=ee(s,t+4,n).times(.5),e.s=i.s,e):new s(NaN):(s.precision=t+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=n,i.times(2)))};E.inverseTangent=E.atan=function(){var e,r,t,n,i,s,o,a,l,c=this,h=c.constructor,w=h.precision,m=h.rounding;if(c.isFinite()){if(c.isZero())return new h(c);if(c.abs().eq(1)&&w+4<=et)return o=ee(h,w+4,m).times(.25),o.s=c.s,o}else{if(!c.s)return new h(NaN);if(w+4<=et)return o=ee(h,w+4,m).times(.5),o.s=c.s,o}for(h.precision=a=w+10,h.rounding=1,t=Math.min(28,a/x+2|0),e=t;e;--e)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(k=!1,r=Math.ceil(a/x),n=1,l=c.times(c),o=new h(c),i=c;e!==-1;)if(i=i.times(l),s=o.minus(i.div(n+=2)),i=i.times(l),o=s.plus(i.div(n+=2)),o.d[r]!==void 0)for(e=r;o.d[e]===s.d[e]&&e--;);return t&&(o=o.times(2<<t-1)),k=!0,S(o,h.precision=w,h.rounding=m,!0)};E.isFinite=function(){return!!this.d};E.isInteger=E.isInt=function(){return!!this.d&&W(this.e/x)>this.d.length-2};E.isNaN=function(){return!this.s};E.isNegative=E.isNeg=function(){return this.s<0};E.isPositive=E.isPos=function(){return this.s>0};E.isZero=function(){return!!this.d&&this.d[0]===0};E.lessThan=E.lt=function(e){return this.cmp(e)<0};E.lessThanOrEqualTo=E.lte=function(e){return this.cmp(e)<1};E.logarithm=E.log=function(e){var r,t,n,i,s,o,a,l,c=this,h=c.constructor,w=h.precision,m=h.rounding,b=5;if(e==null)e=new h(10),r=!0;else{if(e=new h(e),t=e.d,e.s<0||!t||!t[0]||e.eq(1))return new h(NaN);r=e.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new h(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(r)if(t.length>1)s=!0;else{for(i=t[0];i%10===0;)i/=10;s=i!==1}if(k=!1,a=w+b,o=ce(c,a),n=r?_e(h,a+10):ce(e,a),l=D(o,n,a,1),Me(l.d,i=w,m))do if(a+=10,o=ce(c,a),n=r?_e(h,a+10):ce(e,a),l=D(o,n,a,1),!s){+V(l.d).slice(i+1,i+15)+1==1e14&&(l=S(l,w+1,0));break}while(Me(l.d,i+=10,m));return k=!0,S(l,w,m)};E.minus=E.sub=function(e){var r,t,n,i,s,o,a,l,c,h,w,m,b=this,O=b.constructor;if(e=new O(e),!b.d||!e.d)return!b.s||!e.s?e=new O(NaN):b.d?e.s=-e.s:e=new O(e.d||b.s!==e.s?b:NaN),e;if(b.s!=e.s)return e.s=-e.s,b.plus(e);if(c=b.d,m=e.d,a=O.precision,l=O.rounding,!c[0]||!m[0]){if(m[0])e.s=-e.s;else if(c[0])e=new O(b);else return new O(l===3?-0:0);return k?S(e,a,l):e}if(t=W(e.e/x),h=W(b.e/x),c=c.slice(),s=h-t,s){for(w=s<0,w?(r=c,s=-s,o=m.length):(r=m,t=h,o=c.length),n=Math.max(Math.ceil(a/x),o)+2,s>n&&(s=n,r.length=1),r.reverse(),n=s;n--;)r.push(0);r.reverse()}else{for(n=c.length,o=m.length,w=n<o,w&&(o=n),n=0;n<o;n++)if(c[n]!=m[n]){w=c[n]<m[n];break}s=0}for(w&&(r=c,c=m,m=r,e.s=-e.s),o=c.length,n=m.length-o;n>0;--n)c[o++]=0;for(n=m.length;n>s;){if(c[--n]<m[n]){for(i=n;i&&c[--i]===0;)c[i]=K-1;--c[i],c[n]+=K}c[n]-=m[n]}for(;c[--o]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(e.d=c,e.e=Re(c,t),k?S(e,a,l):e):new O(l===3?-0:0)};E.modulo=E.mod=function(e){var r,t=this,n=t.constructor;return e=new n(e),!t.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||t.d&&!t.d[0]?S(new n(t),n.precision,n.rounding):(k=!1,n.modulo==9?(r=D(t,e.abs(),0,3,1),r.s*=e.s):r=D(t,e,0,n.modulo,1),r=r.times(e),k=!0,t.minus(r))};E.naturalExponential=E.exp=function(){return tt(this)};E.naturalLogarithm=E.ln=function(){return ce(this)};E.negated=E.neg=function(){var e=new this.constructor(this);return e.s=-e.s,S(e)};E.plus=E.add=function(e){var r,t,n,i,s,o,a,l,c,h,w=this,m=w.constructor;if(e=new m(e),!w.d||!e.d)return!w.s||!e.s?e=new m(NaN):w.d||(e=new m(e.d||w.s===e.s?w:NaN)),e;if(w.s!=e.s)return e.s=-e.s,w.minus(e);if(c=w.d,h=e.d,a=m.precision,l=m.rounding,!c[0]||!h[0])return h[0]||(e=new m(w)),k?S(e,a,l):e;if(s=W(w.e/x),n=W(e.e/x),c=c.slice(),i=s-n,i){for(i<0?(t=c,i=-i,o=h.length):(t=h,n=s,o=c.length),s=Math.ceil(a/x),o=s>o?s+1:o+1,i>o&&(i=o,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(o=c.length,i=h.length,o-i<0&&(i=o,t=h,h=c,c=t),r=0;i;)r=(c[--i]=c[i]+h[i]+r)/K|0,c[i]%=K;for(r&&(c.unshift(r),++n),o=c.length;c[--o]==0;)c.pop();return e.d=c,e.e=Re(c,n),k?S(e,a,l):e};E.precision=E.sd=function(e){var r,t=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ue+e);return t.d?(r=jt(t.d),e&&t.e+1>r&&(r=t.e+1)):r=NaN,r};E.round=function(){var e=this,r=e.constructor;return S(new r(e),e.e+1,r.rounding)};E.sine=E.sin=function(){var e,r,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(e=n.precision,r=n.rounding,n.precision=e+Math.max(t.e,t.sd())+x,n.rounding=1,t=qr(n,Bt(n,t)),n.precision=e,n.rounding=r,S(oe>2?t.neg():t,e,r,!0)):new n(NaN)};E.squareRoot=E.sqrt=function(){var e,r,t,n,i,s,o=this,a=o.d,l=o.e,c=o.s,h=o.constructor;if(c!==1||!a||!a[0])return new h(!c||c<0&&(!a||a[0])?NaN:a?o:1/0);for(k=!1,c=Math.sqrt(+o),c==0||c==1/0?(r=V(a),(r.length+l)%2==0&&(r+="0"),c=Math.sqrt(r),l=W((l+1)/2)-(l<0||l%2),c==1/0?r="5e"+l:(r=c.toExponential(),r=r.slice(0,r.indexOf("e")+1)+l),n=new h(r)):n=new h(c.toString()),t=(l=h.precision)+3;;)if(s=n,n=s.plus(D(o,s,t+2,1)).times(.5),V(s.d).slice(0,t)===(r=V(n.d)).slice(0,t))if(r=r.slice(t-3,t+1),r=="9999"||!i&&r=="4999"){if(!i&&(S(s,l+1,0),s.times(s).eq(o))){n=s;break}t+=4,i=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(S(n,l+1,1),e=!n.times(n).eq(o));break}return k=!0,S(n,l,h.rounding,e)};E.tangent=E.tan=function(){var e,r,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(e=n.precision,r=n.rounding,n.precision=e+10,n.rounding=1,t=t.sin(),t.s=1,t=D(t,new n(1).minus(t.times(t)).sqrt(),e+10,0),n.precision=e,n.rounding=r,S(oe==2||oe==4?t.neg():t,e,r,!0)):new n(NaN)};E.times=E.mul=function(e){var r,t,n,i,s,o,a,l,c,h=this,w=h.constructor,m=h.d,b=(e=new w(e)).d;if(e.s*=h.s,!m||!m[0]||!b||!b[0])return new w(!e.s||m&&!m[0]&&!b||b&&!b[0]&&!m?NaN:!m||!b?e.s/0:e.s*0);for(t=W(h.e/x)+W(e.e/x),l=m.length,c=b.length,l<c&&(s=m,m=b,b=s,o=l,l=c,c=o),s=[],o=l+c,n=o;n--;)s.push(0);for(n=c;--n>=0;){for(r=0,i=l+n;i>n;)a=s[i]+b[n]*m[i-n-1]+r,s[i--]=a%K|0,r=a/K|0;s[i]=(s[i]+r)%K|0}for(;!s[--o];)s.pop();return r?++t:s.shift(),e.d=s,e.e=Re(s,t),k?S(e,w.precision,w.rounding):e};E.toBinary=function(e,r){return nt(this,2,e,r)};E.toDecimalPlaces=E.toDP=function(e,r){var t=this,n=t.constructor;return t=new n(t),e===void 0?t:(z(e,0,pe),r===void 0?r=n.rounding:z(r,0,8),S(t,e+t.e+1,r))};E.toExponential=function(e,r){var t,n=this,i=n.constructor;return e===void 0?t=te(n,!0):(z(e,0,pe),r===void 0?r=i.rounding:z(r,0,8),n=S(new i(n),e+1,r),t=te(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+t:t};E.toFixed=function(e,r){var t,n,i=this,s=i.constructor;return e===void 0?t=te(i):(z(e,0,pe),r===void 0?r=s.rounding:z(r,0,8),n=S(new s(i),e+i.e+1,r),t=te(n,!1,e+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};E.toFraction=function(e){var r,t,n,i,s,o,a,l,c,h,w,m,b=this,O=b.d,M=b.constructor;if(!O)return new M(b);if(c=t=new M(1),n=l=new M(0),r=new M(n),s=r.e=jt(O)-b.e-1,o=s%x,r.d[0]=U(10,o<0?x+o:o),e==null)e=s>0?r:c;else{if(a=new M(e),!a.isInt()||a.lt(c))throw Error(ue+a);e=a.gt(r)?s>0?r:c:a}for(k=!1,a=new M(V(O)),h=M.precision,M.precision=s=O.length*x*2;w=D(a,r,0,1,1),i=t.plus(w.times(n)),i.cmp(e)!=1;)t=n,n=i,i=c,c=l.plus(w.times(i)),l=i,i=r,r=a.minus(w.times(i)),a=i;return i=D(e.minus(t),n,0,1,1),l=l.plus(i.times(c)),t=t.plus(i.times(n)),l.s=c.s=b.s,m=D(c,n,s,1).minus(b).abs().cmp(D(l,t,s,1).minus(b).abs())<1?[c,n]:[l,t],M.precision=h,k=!0,m};E.toHexadecimal=E.toHex=function(e,r){return nt(this,16,e,r)};E.toNearest=function(e,r){var t=this,n=t.constructor;if(t=new n(t),e==null){if(!t.d)return t;e=new n(1),r=n.rounding}else{if(e=new n(e),r===void 0?r=n.rounding:z(r,0,8),!t.d)return e.s?t:e;if(!e.d)return e.s&&(e.s=t.s),e}return e.d[0]?(k=!1,t=D(t,e,0,r,1).times(e),k=!0,S(t)):(e.s=t.s,t=e),t};E.toNumber=function(){return+this};E.toOctal=function(e,r){return nt(this,8,e,r)};E.toPower=E.pow=function(e){var r,t,n,i,s,o,a=this,l=a.constructor,c=+(e=new l(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new l(U(+a,c));if(a=new l(a),a.eq(1))return a;if(n=l.precision,s=l.rounding,e.eq(1))return S(a,n,s);if(r=W(e.e/x),r>=e.d.length-1&&(t=c<0?-c:c)<=Or)return i=Tt(l,a,t,n),e.s<0?new l(1).div(i):S(i,n,s);if(o=a.s,o<0){if(r<e.d.length-1)return new l(NaN);if((e.d[r]&1)==0&&(o=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=o,a}return t=U(+a,c),r=t==0||!isFinite(t)?W(c*(Math.log("0."+V(a.d))/Math.LN10+a.e+1)):new l(t+"").e,r>l.maxE+1||r<l.minE-1?new l(r>0?o/0:0):(k=!1,l.rounding=a.s=1,t=Math.min(12,(r+"").length),i=tt(e.times(ce(a,n+t)),n),i.d&&(i=S(i,n+5,1),Me(i.d,n,s)&&(r=n+10,i=S(tt(e.times(ce(a,r+t)),r),r+5,1),+V(i.d).slice(n+1,n+15)+1==1e14&&(i=S(i,n+1,0)))),i.s=o,k=!0,l.rounding=s,S(i,n,s))};E.toPrecision=function(e,r){var t,n=this,i=n.constructor;return e===void 0?t=te(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(z(e,1,pe),r===void 0?r=i.rounding:z(r,0,8),n=S(new i(n),e,r),t=te(n,e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+t:t};E.toSignificantDigits=E.toSD=function(e,r){var t=this,n=t.constructor;return e===void 0?(e=n.precision,r=n.rounding):(z(e,1,pe),r===void 0?r=n.rounding:z(r,0,8)),S(new n(t),e,r)};E.toString=function(){var e=this,r=e.constructor,t=te(e,e.e<=r.toExpNeg||e.e>=r.toExpPos);return e.isNeg()&&!e.isZero()?"-"+t:t};E.truncated=E.trunc=function(){return S(new this.constructor(this),this.e+1,1)};E.valueOf=E.toJSON=function(){var e=this,r=e.constructor,t=te(e,e.e<=r.toExpNeg||e.e>=r.toExpPos);return e.isNeg()?"-"+t:t};function V(e){var r,t,n,i=e.length-1,s="",o=e[0];if(i>0){for(s+=o,r=1;r<i;r++)n=e[r]+"",t=x-n.length,t&&(s+=le(t)),s+=n;o=e[r],n=o+"",t=x-n.length,t&&(s+=le(t))}else if(o===0)return"0";for(;o%10===0;)o/=10;return s+o}function z(e,r,t){if(e!==~~e||e<r||e>t)throw Error(ue+e)}function Me(e,r,t,n){var i,s,o,a;for(s=e[0];s>=10;s/=10)--r;return--r<0?(r+=x,i=0):(i=Math.ceil((r+1)/x),r%=x),s=U(10,x-r),a=e[i]%s|0,n==null?r<3?(r==0?a=a/100|0:r==1&&(a=a/10|0),o=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):o=(t<4&&a+1==s||t>3&&a+1==s/2)&&(e[i+1]/s/100|0)==U(10,r-2)-1||(a==s/2||a==0)&&(e[i+1]/s/100|0)==0:r<4?(r==0?a=a/1e3|0:r==1?a=a/100|0:r==2&&(a=a/10|0),o=(n||t<4)&&a==9999||!n&&t>3&&a==4999):o=((n||t<4)&&a+1==s||!n&&t>3&&a+1==s/2)&&(e[i+1]/s/1e3|0)==U(10,r-3)-1,o}function ke(e,r,t){for(var n,i=[0],s,o=0,a=e.length;o<a;){for(s=i.length;s--;)i[s]*=r;for(i[0]+=Ke.indexOf(e.charAt(o++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Lr(e,r){var t,n,i;if(r.isZero())return r;n=r.d.length,n<32?(t=Math.ceil(n/3),i=(1/je(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),e.precision+=t,r=ye(e,1,r.times(i),new e(1));for(var s=t;s--;){var o=r.times(r);r=o.times(o).minus(o).times(8).plus(1)}return e.precision-=t,r}var D=(function(){function e(n,i,s){var o,a=0,l=n.length;for(n=n.slice();l--;)o=n[l]*i+a,n[l]=o%s|0,a=o/s|0;return a&&n.unshift(a),n}function r(n,i,s,o){var a,l;if(s!=o)l=s>o?1:-1;else for(a=l=0;a<s;a++)if(n[a]!=i[a]){l=n[a]>i[a]?1:-1;break}return l}function t(n,i,s,o){for(var a=0;s--;)n[s]-=a,a=n[s]<i[s]?1:0,n[s]=a*o+n[s]-i[s];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,s,o,a,l){var c,h,w,m,b,O,M,Z,_,G,I,T,ae,Q,we,he,fe,$e,X,de,ve=n.constructor,Y=n.s==i.s?1:-1,B=n.d,F=i.d;if(!B||!B[0]||!F||!F[0])return new ve(!n.s||!i.s||(B?F&&B[0]==F[0]:!F)?NaN:B&&B[0]==0||!F?Y*0:Y/0);for(l?(b=1,h=n.e-i.e):(l=K,b=x,h=W(n.e/b)-W(i.e/b)),X=F.length,fe=B.length,_=new ve(Y),G=_.d=[],w=0;F[w]==(B[w]||0);w++);if(F[w]>(B[w]||0)&&h--,s==null?(Q=s=ve.precision,o=ve.rounding):a?Q=s+(n.e-i.e)+1:Q=s,Q<0)G.push(1),O=!0;else{if(Q=Q/b+2|0,w=0,X==1){for(m=0,F=F[0],Q++;(w<fe||m)&&Q--;w++)we=m*l+(B[w]||0),G[w]=we/F|0,m=we%F|0;O=m||w<fe}else{for(m=l/(F[0]+1)|0,m>1&&(F=e(F,m,l),B=e(B,m,l),X=F.length,fe=B.length),he=X,I=B.slice(0,X),T=I.length;T<X;)I[T++]=0;de=F.slice(),de.unshift(0),$e=F[0],F[1]>=l/2&&++$e;do m=0,c=r(F,I,X,T),c<0?(ae=I[0],X!=T&&(ae=ae*l+(I[1]||0)),m=ae/$e|0,m>1?(m>=l&&(m=l-1),M=e(F,m,l),Z=M.length,T=I.length,c=r(M,I,Z,T),c==1&&(m--,t(M,X<Z?de:F,Z,l))):(m==0&&(c=m=1),M=F.slice()),Z=M.length,Z<T&&M.unshift(0),t(I,M,T,l),c==-1&&(T=I.length,c=r(F,I,X,T),c<1&&(m++,t(I,X<T?de:F,T,l))),T=I.length):c===0&&(m++,I=[0]),G[w++]=m,c&&I[0]?I[T++]=B[he]||0:(I=[B[he]],T=1);while((he++<fe||I[0]!==void 0)&&Q--);O=I[0]!==void 0}G[0]||G.shift()}if(b==1)_.e=h,qt=O;else{for(w=1,m=G[0];m>=10;m/=10)w++;_.e=w+h*b-1,S(_,a?s+_.e+1:s,o,O)}return _}})();function S(e,r,t,n){var i,s,o,a,l,c,h,w,m,b=e.constructor;e:if(r!=null){if(w=e.d,!w)return e;for(i=1,a=w[0];a>=10;a/=10)i++;if(s=r-i,s<0)s+=x,o=r,h=w[m=0],l=h/U(10,i-o-1)%10|0;else if(m=Math.ceil((s+1)/x),a=w.length,m>=a)if(n){for(;a++<=m;)w.push(0);h=l=0,i=1,s%=x,o=s-x+1}else break e;else{for(h=a=w[m],i=1;a>=10;a/=10)i++;s%=x,o=s-x+i,l=o<0?0:h/U(10,i-o-1)%10|0}if(n=n||r<0||w[m+1]!==void 0||(o<0?h:h%U(10,i-o-1)),c=t<4?(l||n)&&(t==0||t==(e.s<0?3:2)):l>5||l==5&&(t==4||n||t==6&&(s>0?o>0?h/U(10,i-o):0:w[m-1])%10&1||t==(e.s<0?8:7)),r<1||!w[0])return w.length=0,c?(r-=e.e+1,w[0]=U(10,(x-r%x)%x),e.e=-r||0):w[0]=e.e=0,e;if(s==0?(w.length=m,a=1,m--):(w.length=m+1,a=U(10,x-s),w[m]=o>0?(h/U(10,i-o)%U(10,o)|0)*a:0),c)for(;;)if(m==0){for(s=1,o=w[0];o>=10;o/=10)s++;for(o=w[0]+=a,a=1;o>=10;o/=10)a++;s!=a&&(e.e++,w[0]==K&&(w[0]=1));break}else{if(w[m]+=a,w[m]!=K)break;w[m--]=0,a=1}for(s=w.length;w[--s]===0;)w.pop()}return k&&(e.e>b.maxE?(e.d=null,e.e=NaN):e.e<b.minE&&(e.e=0,e.d=[0])),e}function te(e,r,t){if(!e.isFinite())return Zt(e);var n,i=e.e,s=V(e.d),o=s.length;return r?(t&&(n=t-o)>0?s=s.charAt(0)+"."+s.slice(1)+le(n):o>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):i<0?(s="0."+le(-i-1)+s,t&&(n=t-o)>0&&(s+=le(n))):i>=o?(s+=le(i+1-o),t&&(n=t-i-1)>0&&(s=s+"."+le(n))):((n=i+1)<o&&(s=s.slice(0,n)+"."+s.slice(n)),t&&(n=t-o)>0&&(i+1===o&&(s+="."),s+=le(n))),s}function Re(e,r){var t=e[0];for(r*=x;t>=10;t/=10)r++;return r}function _e(e,r,t){if(r>kr)throw k=!0,t&&(e.precision=t),Error(It);return S(new e(qe),r,1,!0)}function ee(e,r,t){if(r>et)throw Error(It);return S(new e(Ie),r,t,!0)}function jt(e){var r=e.length-1,t=r*x+1;if(r=e[r],r){for(;r%10==0;r/=10)t--;for(r=e[0];r>=10;r/=10)t++}return t}function le(e){for(var r="";e--;)r+="0";return r}function Tt(e,r,t,n){var i,s=new e(1),o=Math.ceil(n/x+4);for(k=!1;;){if(t%2&&(s=s.times(r),kt(s.d,o)&&(i=!0)),t=W(t/2),t===0){t=s.d.length-1,i&&s.d[t]===0&&++s.d[t];break}r=r.times(r),kt(r.d,o)}return k=!0,s}function Ot(e){return e.d[e.d.length-1]&1}function Ut(e,r,t){for(var n,i,s=new e(r[0]),o=0;++o<r.length;){if(i=new e(r[o]),!i.s){s=i;break}n=s.cmp(i),(n===t||n===0&&s.s===t)&&(s=i)}return s}function tt(e,r){var t,n,i,s,o,a,l,c=0,h=0,w=0,m=e.constructor,b=m.rounding,O=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(r==null?(k=!1,l=O):l=r,a=new m(.03125);e.e>-2;)e=e.times(a),w+=5;for(n=Math.log(U(2,w))/Math.LN10*2+5|0,l+=n,t=s=o=new m(1),m.precision=l;;){if(s=S(s.times(e),l,1),t=t.times(++h),a=o.plus(D(s,t,l,1)),V(a.d).slice(0,l)===V(o.d).slice(0,l)){for(i=w;i--;)o=S(o.times(o),l,1);if(r==null)if(c<3&&Me(o.d,l-n,b,c))m.precision=l+=10,t=s=a=new m(1),h=0,c++;else return S(o,m.precision=O,b,k=!0);else return m.precision=O,o}o=a}}function ce(e,r){var t,n,i,s,o,a,l,c,h,w,m,b=1,O=10,M=e,Z=M.d,_=M.constructor,G=_.rounding,I=_.precision;if(M.s<0||!Z||!Z[0]||!M.e&&Z[0]==1&&Z.length==1)return new _(Z&&!Z[0]?-1/0:M.s!=1?NaN:Z?0:M);if(r==null?(k=!1,h=I):h=r,_.precision=h+=O,t=V(Z),n=t.charAt(0),Math.abs(s=M.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)M=M.times(e),t=V(M.d),n=t.charAt(0),b++;s=M.e,n>1?(M=new _("0."+t),s++):M=new _(n+"."+t.slice(1))}else return c=_e(_,h+2,I).times(s+""),M=ce(new _(n+"."+t.slice(1)),h-O).plus(c),_.precision=I,r==null?S(M,I,G,k=!0):M;for(w=M,l=o=M=D(M.minus(1),M.plus(1),h,1),m=S(M.times(M),h,1),i=3;;){if(o=S(o.times(m),h,1),c=l.plus(D(o,new _(i),h,1)),V(c.d).slice(0,h)===V(l.d).slice(0,h))if(l=l.times(2),s!==0&&(l=l.plus(_e(_,h+2,I).times(s+""))),l=D(l,new _(b),h,1),r==null)if(Me(l.d,h-O,G,a))_.precision=h+=O,c=o=M=D(w.minus(1),w.plus(1),h,1),m=S(M.times(M),h,1),i=a=1;else return S(l,_.precision=I,G,k=!0);else return _.precision=I,l;l=c,i+=2}}function Zt(e){return String(e.s*e.s/0)}function Le(e,r){var t,n,i;for((t=r.indexOf("."))>-1&&(r=r.replace(".","")),(n=r.search(/e/i))>0?(t<0&&(t=n),t+=+r.slice(n+1),r=r.substring(0,n)):t<0&&(t=r.length),n=0;r.charCodeAt(n)===48;n++);for(i=r.length;r.charCodeAt(i-1)===48;--i);if(r=r.slice(n,i),r){if(i-=n,e.e=t=t-n-1,e.d=[],n=(t+1)%x,t<0&&(n+=x),n<i){for(n&&e.d.push(+r.slice(0,n)),i-=x;n<i;)e.d.push(+r.slice(n,n+=x));r=r.slice(n),n=x-r.length}else n-=i;for(;n--;)r+="0";e.d.push(+r),k&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Fr(e,r){var t,n,i,s,o,a,l,c,h;if(r.indexOf("_")>-1){if(r=r.replace(/(\d)_(?=\d)/g,"$1"),Rt.test(r))return Le(e,r)}else if(r==="Infinity"||r==="NaN")return+r||(e.s=NaN),e.e=NaN,e.d=null,e;if(Pr.test(r))t=16,r=r.toLowerCase();else if(Mr.test(r))t=2;else if(xr.test(r))t=8;else throw Error(ue+r);for(s=r.search(/p/i),s>0?(l=+r.slice(s+1),r=r.substring(2,s)):r=r.slice(2),s=r.indexOf("."),o=s>=0,n=e.constructor,o&&(r=r.replace(".",""),a=r.length,s=a-s,i=Tt(n,new n(t),s,s*2)),c=ke(r,t,K),h=c.length-1,s=h;c[s]===0;--s)c.pop();return s<0?new n(e.s*0):(e.e=Re(c,h),e.d=c,k=!1,o&&(e=D(e,i,a*4)),l&&(e=e.times(Math.abs(l)<54?U(2,l):L.pow(2,l))),k=!0,e)}function qr(e,r){var t,n=r.d.length;if(n<3)return r.isZero()?r:ye(e,2,r,r);t=1.4*Math.sqrt(n),t=t>16?16:t|0,r=r.times(1/je(5,t)),r=ye(e,2,r,r);for(var i,s=new e(5),o=new e(16),a=new e(20);t--;)i=r.times(r),r=r.times(s.plus(i.times(o.times(i).minus(a))));return r}function ye(e,r,t,n,i){var s,o,a,l,c=e.precision,h=Math.ceil(c/x);for(k=!1,l=t.times(t),a=new e(n);;){if(o=D(a.times(l),new e(r++*r++),c,1),a=i?n.plus(o):n.minus(o),n=D(o.times(l),new e(r++*r++),c,1),o=a.plus(n),o.d[h]!==void 0){for(s=h;o.d[s]===a.d[s]&&s--;);if(s==-1)break}s=a,a=n,n=o,o=s}return k=!0,o.d.length=h+1,o}function je(e,r){for(var t=e;--r;)t*=e;return t}function Bt(e,r){var t,n=r.s<0,i=ee(e,e.precision,1),s=i.times(.5);if(r=r.abs(),r.lte(s))return oe=n?4:1,r;if(t=r.divToInt(i),t.isZero())oe=n?3:2;else{if(r=r.minus(t.times(i)),r.lte(s))return oe=Ot(t)?n?2:3:n?4:1,r;oe=Ot(t)?n?1:4:n?3:2}return r.minus(i).abs()}function nt(e,r,t,n){var i,s,o,a,l,c,h,w,m,b=e.constructor,O=t!==void 0;if(O?(z(t,1,pe),n===void 0?n=b.rounding:z(n,0,8)):(t=b.precision,n=b.rounding),!e.isFinite())h=Zt(e);else{for(h=te(e),o=h.indexOf("."),O?(i=2,r==16?t=t*4-3:r==8&&(t=t*3-2)):i=r,o>=0&&(h=h.replace(".",""),m=new b(1),m.e=h.length-o,m.d=ke(te(m),10,i),m.e=m.d.length),w=ke(h,10,i),s=l=w.length;w[--l]==0;)w.pop();if(!w[0])h=O?"0p+0":"0";else{if(o<0?s--:(e=new b(e),e.d=w,e.e=s,e=D(e,m,t,n,0,i),w=e.d,s=e.e,c=qt),o=w[t],a=i/2,c=c||w[t+1]!==void 0,c=n<4?(o!==void 0||c)&&(n===0||n===(e.s<0?3:2)):o>a||o===a&&(n===4||c||n===6&&w[t-1]&1||n===(e.s<0?8:7)),w.length=t,c)for(;++w[--t]>i-1;)w[t]=0,t||(++s,w.unshift(1));for(l=w.length;!w[l-1];--l);for(o=0,h="";o<l;o++)h+=Ke.charAt(w[o]);if(O){if(l>1)if(r==16||r==8){for(o=r==16?4:3,--l;l%o;l++)h+="0";for(w=ke(h,i,r),l=w.length;!w[l-1];--l);for(o=1,h="1.";o<l;o++)h+=Ke.charAt(w[o])}else h=h.charAt(0)+"."+h.slice(1);h=h+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)h="0"+h;h="0."+h}else if(++s>l)for(s-=l;s--;)h+="0";else s<l&&(h=h.slice(0,s)+"."+h.slice(s))}h=(r==16?"0x":r==2?"0b":r==8?"0o":"")+h}return e.s<0?"-"+h:h}function kt(e,r){if(e.length>r)return e.length=r,!0}function Ir(e){return new this(e).abs()}function _r(e){return new this(e).acos()}function Dr(e){return new this(e).acosh()}function Rr(e,r){return new this(e).plus(r)}function jr(e){return new this(e).asin()}function Tr(e){return new this(e).asinh()}function Ur(e){return new this(e).atan()}function Zr(e){return new this(e).atanh()}function Br(e,r){e=new this(e),r=new this(r);var t,n=this.precision,i=this.rounding,s=n+4;return!e.s||!r.s?t=new this(NaN):!e.d&&!r.d?(t=ee(this,s,1).times(r.s>0?.25:.75),t.s=e.s):!r.d||e.isZero()?(t=r.s<0?ee(this,n,i):new this(0),t.s=e.s):!e.d||r.isZero()?(t=ee(this,s,1).times(.5),t.s=e.s):r.s<0?(this.precision=s,this.rounding=1,t=this.atan(D(e,r,s,1)),r=ee(this,s,1),this.precision=n,this.rounding=i,t=e.s<0?t.minus(r):t.plus(r)):t=this.atan(D(e,r,s,1)),t}function Vr(e){return new this(e).cbrt()}function Hr(e){return S(e=new this(e),e.e+1,2)}function Wr(e,r,t){return new this(e).clamp(r,t)}function Gr(e){if(!e||typeof e!="object")throw Error(De+"Object expected");var r,t,n,i=e.defaults===!0,s=["precision",1,pe,"rounding",0,8,"toExpNeg",-Ne,0,"toExpPos",0,Ne,"maxE",0,Ne,"minE",-Ne,0,"modulo",0,9];for(r=0;r<s.length;r+=3)if(t=s[r],i&&(this[t]=Ye[t]),(n=e[t])!==void 0)if(W(n)===n&&n>=s[r+1]&&n<=s[r+2])this[t]=n;else throw Error(ue+t+": "+n);if(t="crypto",i&&(this[t]=Ye[t]),(n=e[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(_t);else this[t]=!1;else throw Error(ue+t+": "+n);return this}function Xr(e){return new this(e).cos()}function zr(e){return new this(e).cosh()}function Vt(e){var r,t,n;function i(s){var o,a,l,c=this;if(!(c instanceof i))return new i(s);if(c.constructor=i,Lt(s)){c.s=s.s,k?!s.d||s.e>i.maxE?(c.e=NaN,c.d=null):s.e<i.minE?(c.e=0,c.d=[0]):(c.e=s.e,c.d=s.d.slice()):(c.e=s.e,c.d=s.d?s.d.slice():s.d);return}if(l=typeof s,l==="number"){if(s===0){c.s=1/s<0?-1:1,c.e=0,c.d=[0];return}if(s<0?(s=-s,c.s=-1):c.s=1,s===~~s&&s<1e7){for(o=0,a=s;a>=10;a/=10)o++;k?o>i.maxE?(c.e=NaN,c.d=null):o<i.minE?(c.e=0,c.d=[0]):(c.e=o,c.d=[s]):(c.e=o,c.d=[s]);return}if(s*0!==0){s||(c.s=NaN),c.e=NaN,c.d=null;return}return Le(c,s.toString())}if(l==="string")return(a=s.charCodeAt(0))===45?(s=s.slice(1),c.s=-1):(a===43&&(s=s.slice(1)),c.s=1),Rt.test(s)?Le(c,s):Fr(c,s);if(l==="bigint")return s<0?(s=-s,c.s=-1):c.s=1,Le(c,s.toString());throw Error(ue+s)}if(i.prototype=E,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Gr,i.clone=Vt,i.isDecimal=Lt,i.abs=Ir,i.acos=_r,i.acosh=Dr,i.add=Rr,i.asin=jr,i.asinh=Tr,i.atan=Ur,i.atanh=Zr,i.atan2=Br,i.cbrt=Vr,i.ceil=Hr,i.clamp=Wr,i.cos=Xr,i.cosh=zr,i.div=Qr,i.exp=Jr,i.floor=Kr,i.hypot=Yr,i.ln=en,i.log=tn,i.log10=nn,i.log2=rn,i.max=sn,i.min=on,i.mod=an,i.mul=fn,i.pow=ln,i.random=cn,i.round=un,i.sign=pn,i.sin=hn,i.sinh=dn,i.sqrt=gn,i.sub=mn,i.sum=wn,i.tan=$n,i.tanh=vn,i.trunc=En,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<n.length;)e.hasOwnProperty(t=n[r++])||(e[t]=this[t]);return i.config(e),i}function Qr(e,r){return new this(e).div(r)}function Jr(e){return new this(e).exp()}function Kr(e){return S(e=new this(e),e.e+1,3)}function Yr(){var e,r,t=new this(0);for(k=!1,e=0;e<arguments.length;)if(r=new this(arguments[e++]),r.d)t.d&&(t=t.plus(r.times(r)));else{if(r.s)return k=!0,new this(1/0);t=r}return k=!0,t.sqrt()}function Lt(e){return e instanceof L||e&&e.toStringTag===Dt||!1}function en(e){return new this(e).ln()}function tn(e,r){return new this(e).log(r)}function rn(e){return new this(e).log(2)}function nn(e){return new this(e).log(10)}function sn(){return Ut(this,arguments,-1)}function on(){return Ut(this,arguments,1)}function an(e,r){return new this(e).mod(r)}function fn(e,r){return new this(e).mul(r)}function ln(e,r){return new this(e).pow(r)}function cn(e){var r,t,n,i,s=0,o=new this(1),a=[];if(e===void 0?e=this.precision:z(e,1,pe),n=Math.ceil(e/x),this.crypto)if(crypto.getRandomValues)for(r=crypto.getRandomValues(new Uint32Array(n));s<n;)i=r[s],i>=429e7?r[s]=crypto.getRandomValues(new Uint32Array(1))[0]:a[s++]=i%1e7;else if(crypto.randomBytes){for(r=crypto.randomBytes(n*=4);s<n;)i=r[s]+(r[s+1]<<8)+(r[s+2]<<16)+((r[s+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(r,s):(a.push(i%1e7),s+=4);s=n/4}else throw Error(_t);else for(;s<n;)a[s++]=Math.random()*1e7|0;for(n=a[--s],e%=x,n&&e&&(i=U(10,x-e),a[s]=(n/i|0)*i);a[s]===0;s--)a.pop();if(s<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=x)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<x&&(t-=x-n)}return o.e=t,o.d=a,o}function un(e){return S(e=new this(e),e.e+1,this.rounding)}function pn(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function hn(e){return new this(e).sin()}function dn(e){return new this(e).sinh()}function gn(e){return new this(e).sqrt()}function mn(e,r){return new this(e).sub(r)}function wn(){var e=0,r=arguments,t=new this(r[e]);for(k=!1;t.s&&++e<r.length;)t=t.plus(r[e]);return k=!0,S(t,this.precision,this.rounding)}function $n(e){return new this(e).tan()}function vn(e){return new this(e).tanh()}function En(e){return S(e=new this(e),e.e+1,1)}E[Symbol.for("nodejs.util.inspect.custom")]=E.toString;E[Symbol.toStringTag]="Decimal";var L=E.constructor=Vt(Ye);qe=new L(qe);Ie=new L(Ie);class Ft extends SyntaxError{constructor(r,t,n,i){super(r),this.expected=t,this.found=n,this.location=i,this.name="SyntaxError"}format(r){let t="Error: "+this.message;if(this.location){let n=null;const i=r.find(l=>l.source===this.location.source);i&&(n=i.text.split(/\r\n|\n|\r/g));const s=this.location.start,o=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,a=this.location.source+":"+o.line+":"+o.column;if(n){const l=this.location.end,c="".padEnd(o.line.toString().length," "),h=n[s.line-1],m=(s.line===l.line?l.column:h.length+1)-s.column||1;t+=`
 --> `+a+`
`+c+` |
`+o.line+" | "+h+`
`+c+" | "+"".padEnd(s.column-1," ")+"".padEnd(m,"^")}else t+=`
 at `+a}return t}static buildMessage(r,t){function n(m){return m.codePointAt(0).toString(16).toUpperCase()}const i=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function s(m){return i?m.replace(i,b=>"\\u{"+n(b)+"}"):m}function o(m){return s(m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,b=>"\\x0"+n(b)).replace(/[\x10-\x1F\x7F-\x9F]/g,b=>"\\x"+n(b)))}function a(m){return s(m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,b=>"\\x0"+n(b)).replace(/[\x10-\x1F\x7F-\x9F]/g,b=>"\\x"+n(b)))}const l={literal(m){return'"'+o(m.text)+'"'},class(m){const b=m.parts.map(O=>Array.isArray(O)?a(O[0])+"-"+a(O[1]):a(O));return"["+(m.inverted?"^":"")+b.join("")+"]"+(m.unicode?"u":"")},any(){return"any character"},end(){return"end of input"},other(m){return m.description}};function c(m){return l[m.type](m)}function h(m){const b=m.map(c);if(b.sort(),b.length>0){let O=1;for(let M=1;M<b.length;M++)b[M-1]!==b[M]&&(b[O]=b[M],O++);b.length=O}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function w(m){return m?'"'+o(m)+'"':"end of input"}return"Expected "+h(r)+" but "+w(t)+" found."}}function Ht(e,r){r=r!==void 0?r:{};const t={},n=r.grammarSource,i={Expression:ne};let s=ne;const o="?",a=":",l="||",c="??",h="&&",w="!=",m="==",b="=",O="<=",M=">=",Z="**",_="(",G=")",I="[",T="]",ae=".",Q=",",we="true",he="false",fe="null",$e=/^[<>]/,X=/^[+\-]/,de=/^[%*\/]/,ve=/^[!+\-]/,Y=/^[0-9]/,B=/^[eE]/,F=/^[a-zA-Z0-9_$]/,Wt=/^[a-zA-Z_$]/,st=/^[ \t\n\r]/,Gt=j("?",!1),Xt=j(":",!1),ot=j("||",!1),at=j("??",!1),ft=j("&&",!1),lt=j("!=",!1),ct=j("==",!1),ut=j("=",!1),pt=j("<=",!1),ht=j(">=",!1),dt=re(["<",">"],!1,!1,!1),Ue=re(["+","-"],!1,!1,!1),gt=re(["%","*","/"],!1,!1,!1),zt=j("**",!1),Qt=re(["!","+","-"],!1,!1,!1),Ze=j("(",!1),Be=j(")",!1),mt=j("[",!1),wt=j("]",!1),Ve=j(".",!1),$t=j(",",!1),Ee=re([["0","9"]],!1,!1,!1),Jt=re(["e","E"],!1,!1,!1),Kt=j("true",!1),Ae=re([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1,!1),Yt=j("false",!1),er=j("null",!1),tr=re([["a","z"],["A","Z"],"_","$"],!1,!1,!1),vt=re([" ","	",`
`,"\r"],!1,!1,!1);function Ln(p){return p}function rr(p,d,v){return{type:"ConditionalExpression",test:p,consequent:d,alternate:v}}function nr(p,d){return d.reduce((v,u)=>({type:"LogicalExpression",operator:u[1],left:v,right:u[3]}),p)}function ir(p,d){return d.reduce((v,u)=>({type:"LogicalExpression",operator:u[1],left:v,right:u[3]}),p)}function sr(p,d){return Oe(p,d)}function or(p,d){return Oe(p,d)}function ar(p,d){return Oe(p,d)}function fr(p,d){return Oe(p,d)}function lr(p,d){return d?{type:"BinaryExpression",operator:"**",left:p,right:d[3]}:p}function cr(p,d){return{type:"UnaryExpression",operator:p,argument:d,prefix:!0}}function Et(p,d){return{type:"call",args:d||[]}}function bt(p,d){return{type:"member",property:d,computed:!0}}function Nt(p,d){return{type:"member",property:d,computed:!1}}function ur(p,d){return d.reduce((v,u)=>u.type==="call"?{type:"CallExpression",callee:v,arguments:u.args}:{type:"MemberExpression",object:v,property:u.property,computed:u.computed},p)}function pr(p,d){return[p].concat(d.map(v=>v[3]))}function Fn(p){return p}function hr(p){return{type:"Literal",value:parseFloat(p),raw:p}}function dr(){return{type:"Literal",value:!0,raw:"true"}}function gr(){return{type:"Literal",value:!1,raw:"false"}}function mr(){return{type:"Literal",value:null,raw:"null"}}function wr(p){return{type:"Identifier",name:p}}let f=r.peg$currPos|0;const be=[{line:1,column:1}];let J=f,Pe=r.peg$maxFailExpected||[],N=r.peg$silentFails|0,Ce;if(r.startRule){if(!(r.startRule in i))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');s=i[r.startRule]}function $r(p=f){const d=e.codePointAt(p);return d===void 0?"":String.fromCodePoint(d)}function j(p,d){return{type:"literal",text:p,ignoreCase:d}}function re(p,d,v,u){return{type:"class",parts:p,inverted:d,ignoreCase:v,unicode:u}}function vr(){return{type:"end"}}function yt(p){let d=be[p],v;if(d)return d;if(p>=be.length)v=be.length-1;else for(v=p;!be[--v];);for(d=be[v],d={line:d.line,column:d.column};v<p;)e.charCodeAt(v)===10?(d.line++,d.column=1):d.column++,v++;return be[p]=d,d}function At(p,d,v){const u=yt(p),$=yt(d);return{source:n,start:{offset:p,line:u.line,column:u.column},end:{offset:d,line:$.line,column:$.column}}}function C(p){f<J||(f>J&&(J=f,Pe=[]),Pe.push(p))}function Er(p,d,v){return new Ft(Ft.buildMessage(p,d),p,d,v)}function ne(){let p,d;return p=f,P(),d=Ct(),d!==t?(P(),p=d):(f=p,p=t),p}function Ct(){let p,d,v,u,$,g;return p=f,d=St(),d!==t?(P(),e.charCodeAt(f)===63?(v=o,f++):(v=t,N===0&&C(Gt)),v!==t?(P(),u=ne(),u!==t?(P(),e.charCodeAt(f)===58?($=a,f++):($=t,N===0&&C(Xt)),$!==t?(P(),g=Ct(),g!==t?p=rr(d,u,g):(f=p,p=t)):(f=p,p=t)):(f=p,p=t)):(f=p,p=t)):(f=p,p=t),p===t&&(p=St()),p}function St(){let p,d,v,u,$,g,y,A;if(p=f,d=He(),d!==t){for(v=[],u=f,$=P(),e.substr(f,2)===l?(g=l,f+=2):(g=t,N===0&&C(ot)),g===t&&(e.substr(f,2)===c?(g=c,f+=2):(g=t,N===0&&C(at))),g!==t?(y=P(),A=He(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);u!==t;)v.push(u),u=f,$=P(),e.substr(f,2)===l?(g=l,f+=2):(g=t,N===0&&C(ot)),g===t&&(e.substr(f,2)===c?(g=c,f+=2):(g=t,N===0&&C(at))),g!==t?(y=P(),A=He(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);p=nr(d,v)}else f=p,p=t;return p}function He(){let p,d,v,u,$,g,y,A;if(p=f,d=We(),d!==t){for(v=[],u=f,$=P(),e.substr(f,2)===h?(g=h,f+=2):(g=t,N===0&&C(ft)),g!==t?(y=P(),A=We(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);u!==t;)v.push(u),u=f,$=P(),e.substr(f,2)===h?(g=h,f+=2):(g=t,N===0&&C(ft)),g!==t?(y=P(),A=We(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);p=ir(d,v)}else f=p,p=t;return p}function We(){let p,d,v,u,$,g,y,A;if(p=f,d=Ge(),d!==t){for(v=[],u=f,$=P(),e.substr(f,2)===w?(g=w,f+=2):(g=t,N===0&&C(lt)),g===t&&(e.substr(f,2)===m?(g=m,f+=2):(g=t,N===0&&C(ct)),g===t&&(e.charCodeAt(f)===61?(g=b,f++):(g=t,N===0&&C(ut)))),g!==t?(y=P(),A=Ge(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);u!==t;)v.push(u),u=f,$=P(),e.substr(f,2)===w?(g=w,f+=2):(g=t,N===0&&C(lt)),g===t&&(e.substr(f,2)===m?(g=m,f+=2):(g=t,N===0&&C(ct)),g===t&&(e.charCodeAt(f)===61?(g=b,f++):(g=t,N===0&&C(ut)))),g!==t?(y=P(),A=Ge(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);p=sr(d,v)}else f=p,p=t;return p}function Ge(){let p,d,v,u,$,g,y,A;if(p=f,d=Xe(),d!==t){for(v=[],u=f,$=P(),e.substr(f,2)===O?(g=O,f+=2):(g=t,N===0&&C(pt)),g===t&&(e.substr(f,2)===M?(g=M,f+=2):(g=t,N===0&&C(ht)),g===t&&(g=e.charAt(f),$e.test(g)?f++:(g=t,N===0&&C(dt)))),g!==t?(y=P(),A=Xe(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);u!==t;)v.push(u),u=f,$=P(),e.substr(f,2)===O?(g=O,f+=2):(g=t,N===0&&C(pt)),g===t&&(e.substr(f,2)===M?(g=M,f+=2):(g=t,N===0&&C(ht)),g===t&&(g=e.charAt(f),$e.test(g)?f++:(g=t,N===0&&C(dt)))),g!==t?(y=P(),A=Xe(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);p=or(d,v)}else f=p,p=t;return p}function Xe(){let p,d,v,u,$,g,y,A;if(p=f,d=ze(),d!==t){for(v=[],u=f,$=P(),g=e.charAt(f),X.test(g)?f++:(g=t,N===0&&C(Ue)),g!==t?(y=P(),A=ze(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);u!==t;)v.push(u),u=f,$=P(),g=e.charAt(f),X.test(g)?f++:(g=t,N===0&&C(Ue)),g!==t?(y=P(),A=ze(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);p=ar(d,v)}else f=p,p=t;return p}function ze(){let p,d,v,u,$,g,y,A;if(p=f,d=xe(),d!==t){for(v=[],u=f,$=P(),g=e.charAt(f),de.test(g)?f++:(g=t,N===0&&C(gt)),g!==t?(y=P(),A=xe(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);u!==t;)v.push(u),u=f,$=P(),g=e.charAt(f),de.test(g)?f++:(g=t,N===0&&C(gt)),g!==t?(y=P(),A=xe(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);p=fr(d,v)}else f=p,p=t;return p}function xe(){let p,d,v,u,$,g,y;return p=f,d=Mt(),d!==t?(v=f,u=P(),e.substr(f,2)===Z?($=Z,f+=2):($=t,N===0&&C(zt)),$!==t?(g=P(),y=xe(),y!==t?(u=[u,$,g,y],v=u):(f=v,v=t)):(f=v,v=t),v===t&&(v=null),p=lr(d,v)):(f=p,p=t),p}function Mt(){let p,d,v;return p=f,d=e.charAt(f),ve.test(d)?f++:(d=t,N===0&&C(Qt)),d!==t?(P(),v=Mt(),v!==t?p=cr(d,v):(f=p,p=t)):(f=p,p=t),p===t&&(p=br()),p}function br(){let p,d,v,u,$,g,y;if(p=f,d=Nr(),d!==t){for(v=[],u=f,P(),e.charCodeAt(f)===40?($=_,f++):($=t,N===0&&C(Ze)),$!==t?(P(),g=Pt(),g===t&&(g=null),P(),e.charCodeAt(f)===41?(y=G,f++):(y=t,N===0&&C(Be)),y!==t?u=Et(d,g):(f=u,u=t)):(f=u,u=t),u===t&&(u=f,P(),e.charCodeAt(f)===91?($=I,f++):($=t,N===0&&C(mt)),$!==t?(P(),g=ne(),g!==t?(P(),e.charCodeAt(f)===93?(y=T,f++):(y=t,N===0&&C(wt)),y!==t?u=bt(d,g):(f=u,u=t)):(f=u,u=t)):(f=u,u=t),u===t&&(u=f,P(),e.charCodeAt(f)===46?($=ae,f++):($=t,N===0&&C(Ve)),$!==t?(P(),g=Qe(),g!==t?u=Nt(d,g):(f=u,u=t)):(f=u,u=t)));u!==t;)v.push(u),u=f,P(),e.charCodeAt(f)===40?($=_,f++):($=t,N===0&&C(Ze)),$!==t?(P(),g=Pt(),g===t&&(g=null),P(),e.charCodeAt(f)===41?(y=G,f++):(y=t,N===0&&C(Be)),y!==t?u=Et(d,g):(f=u,u=t)):(f=u,u=t),u===t&&(u=f,P(),e.charCodeAt(f)===91?($=I,f++):($=t,N===0&&C(mt)),$!==t?(P(),g=ne(),g!==t?(P(),e.charCodeAt(f)===93?(y=T,f++):(y=t,N===0&&C(wt)),y!==t?u=bt(d,g):(f=u,u=t)):(f=u,u=t)):(f=u,u=t),u===t&&(u=f,P(),e.charCodeAt(f)===46?($=ae,f++):($=t,N===0&&C(Ve)),$!==t?(P(),g=Qe(),g!==t?u=Nt(d,g):(f=u,u=t)):(f=u,u=t)));p=ur(d,v)}else f=p,p=t;return p}function Pt(){let p,d,v,u,$,g,y,A;if(p=f,d=ne(),d!==t){for(v=[],u=f,$=P(),e.charCodeAt(f)===44?(g=Q,f++):(g=t,N===0&&C($t)),g!==t?(y=P(),A=ne(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);u!==t;)v.push(u),u=f,$=P(),e.charCodeAt(f)===44?(g=Q,f++):(g=t,N===0&&C($t)),g!==t?(y=P(),A=ne(),A!==t?($=[$,g,y,A],u=$):(f=u,u=t)):(f=u,u=t);p=pr(d,v)}else f=p,p=t;return p}function Nr(){let p,d,v,u;return p=yr(),p===t&&(p=Qe(),p===t&&(p=f,e.charCodeAt(f)===40?(d=_,f++):(d=t,N===0&&C(Ze)),d!==t?(P(),v=ne(),v!==t?(P(),e.charCodeAt(f)===41?(u=G,f++):(u=t,N===0&&C(Be)),u!==t?p=v:(f=p,p=t)):(f=p,p=t)):(f=p,p=t))),p}function yr(){let p;return p=Ar(),p===t&&(p=Cr(),p===t&&(p=Sr())),p}function Ar(){let p,d,v,u,$,g,y,A,Se,ie;if(p=f,d=f,v=f,u=[],$=e.charAt(f),Y.test($)?f++:($=t,N===0&&C(Ee)),$!==t)for(;$!==t;)u.push($),$=e.charAt(f),Y.test($)?f++:($=t,N===0&&C(Ee));else u=t;if(u!==t){if($=f,e.charCodeAt(f)===46?(g=ae,f++):(g=t,N===0&&C(Ve)),g!==t){if(y=[],A=e.charAt(f),Y.test(A)?f++:(A=t,N===0&&C(Ee)),A!==t)for(;A!==t;)y.push(A),A=e.charAt(f),Y.test(A)?f++:(A=t,N===0&&C(Ee));else y=t;y!==t?(g=[g,y],$=g):(f=$,$=t)}else f=$,$=t;if($===t&&($=null),g=f,y=e.charAt(f),B.test(y)?f++:(y=t,N===0&&C(Jt)),y!==t){if(A=e.charAt(f),X.test(A)?f++:(A=t,N===0&&C(Ue)),A===t&&(A=null),Se=[],ie=e.charAt(f),Y.test(ie)?f++:(ie=t,N===0&&C(Ee)),ie!==t)for(;ie!==t;)Se.push(ie),ie=e.charAt(f),Y.test(ie)?f++:(ie=t,N===0&&C(Ee));else Se=t;Se!==t?(y=[y,A,Se],g=y):(f=g,g=t)}else f=g,g=t;g===t&&(g=null),u=[u,$,g],v=u}else f=v,v=t;return v!==t?d=e.substring(d,f):d=v,d!==t&&(d=hr(d)),p=d,p}function Cr(){let p,d,v,u;return p=f,e.substr(f,4)===we?(d=we,f+=4):(d=t,N===0&&C(Kt)),d!==t?(v=f,N++,u=e.charAt(f),F.test(u)?f++:(u=t,N===0&&C(Ae)),N--,u===t?v=void 0:(f=v,v=t),v!==t?p=dr():(f=p,p=t)):(f=p,p=t),p===t&&(p=f,e.substr(f,5)===he?(d=he,f+=5):(d=t,N===0&&C(Yt)),d!==t?(v=f,N++,u=e.charAt(f),F.test(u)?f++:(u=t,N===0&&C(Ae)),N--,u===t?v=void 0:(f=v,v=t),v!==t?p=gr():(f=p,p=t)):(f=p,p=t)),p}function Sr(){let p,d,v,u;return p=f,e.substr(f,4)===fe?(d=fe,f+=4):(d=t,N===0&&C(er)),d!==t?(v=f,N++,u=e.charAt(f),F.test(u)?f++:(u=t,N===0&&C(Ae)),N--,u===t?v=void 0:(f=v,v=t),v!==t?p=mr():(f=p,p=t)):(f=p,p=t),p}function Qe(){let p,d,v,u,$,g;if(p=f,d=f,v=f,u=e.charAt(f),Wt.test(u)?f++:(u=t,N===0&&C(tr)),u!==t){for($=[],g=e.charAt(f),F.test(g)?f++:(g=t,N===0&&C(Ae));g!==t;)$.push(g),g=e.charAt(f),F.test(g)?f++:(g=t,N===0&&C(Ae));u=[u,$],v=u}else f=v,v=t;return v!==t?d=e.substring(d,f):d=v,d!==t&&(d=wr(d)),p=d,p}function P(){let p,d;for(N++,p=[],d=e.charAt(f),st.test(d)?f++:(d=t,N===0&&C(vt));d!==t;)p.push(d),d=e.charAt(f),st.test(d)?f++:(d=t,N===0&&C(vt));return N--,p}function Oe(p,d){return d.reduce((v,u)=>({type:"BinaryExpression",operator:u[1],left:v,right:u[3]}),p)}Ce=s();const Je=Ce!==t&&f===e.length;function xt(){throw Ce!==t&&f<e.length&&C(vr()),Er(Pe,J<e.length?$r(J):null,J<e.length?At(J,J+1):At(J,J))}if(r.peg$library)return{peg$result:Ce,peg$currPos:f,peg$FAILED:t,peg$maxFailExpected:Pe,peg$maxFailPos:J,peg$success:Je,peg$throw:Je?void 0:xt};if(Je)return Ce;xt()}const bn=e=>{const r=new Set,t=n=>{if(!(!n||typeof n!="object"))switch(n.type){case"Identifier":r.add(n.name);break;case"MemberExpression":t(n.object),n.computed&&t(n.property);break;case"BinaryExpression":case"LogicalExpression":t(n.left),t(n.right);break;case"UnaryExpression":t(n.argument);break;case"CallExpression":if(t(n.callee),n.arguments)for(const i of n.arguments)t(i);break;case"ConditionalExpression":t(n.test),t(n.consequent),t(n.alternate);break;case"ArrayExpression":if(n.elements)for(const i of n.elements)t(i);break;case"ObjectExpression":if(n.properties)for(const i of n.properties)i.type==="Property"?(i.computed&&t(i.key),t(i.value)):i.type==="SpreadElement"&&t(i.argument);break}};return t(e),Array.from(r).filter(n=>!n.startsWith("$"))};class me extends Error{constructor(r){super(r),this.name="EvallaError",Object.setPrototypeOf(this,me.prototype)}}class Te extends me{constructor(r,t){super(r),this.name="SecurityError",this.property=t,Object.setPrototypeOf(this,Te.prototype)}}class it extends me{constructor(r,t){super(r),this.name="CircularDependencyError",this.cycle=t,Object.setPrototypeOf(this,it.prototype)}}class se extends me{constructor(r,t){super(r),this.name="ValidationError",this.variableName=t,Object.setPrototypeOf(this,se.prototype)}}class R extends me{constructor(r,t){super(r),this.name="EvaluationError",this.variableName=t,Object.setPrototypeOf(this,R.prototype)}}class ge extends R{constructor(r,t){super(r,t?.variableName),this.name="ParseError",this.expression=t?.expression,this.line=t?.line,this.column=t?.column,Object.setPrototypeOf(this,ge.prototype)}}const Nn=e=>{try{return Ht(e.trim())}catch(r){if(r.location){const{line:t,column:n}=r.location.start;throw new ge(`Parse error at line ${t}, column ${n}: ${r.message}`,{line:t,column:n,expression:e})}throw new ge(`Parse error: ${r.message}`,{expression:e})}},yn=e=>bn(e),An=e=>{const r=new Map,t=new Set,n=new Map;for(const l of e)if(t.add(l.name),l.expr)try{const c=Nn(l.expr);n.set(l.name,c)}catch(c){throw c instanceof ge?new ge(`Failed to parse expression for "${l.name}": ${c.message}`,{variableName:l.name,expression:l.expr,line:c.line,column:c.column}):new ge(`Failed to parse expression for "${l.name}": ${c instanceof Error?c.message:String(c)}`,{variableName:l.name,expression:l.expr})}for(const l of e){if(!l.expr){r.set(l.name,[]);continue}const c=n.get(l.name);if(!c)throw new R(`No AST found for: ${l.name}`);const w=yn(c).filter(m=>t.has(m));r.set(l.name,w)}const i=new Set,s=new Set,o=[],a=(l,c=[])=>{if(i.has(l))return;if(s.has(l)){const w=[...c,l];throw new it(`Circular dependency detected: ${w.join(" -> ")}`,w)}s.add(l);const h=r.get(l)||[];for(const w of h)t.has(w)&&a(w,[...c,l]);s.delete(l),i.add(l),o.push(l)};for(const l of t)a(l);return{order:o,asts:n}},q=e=>e instanceof L?e:new L(e),Fe=Symbol("NAMESPACE_HEAD"),rt=e=>e!=null&&typeof e=="object"&&e[Fe]===!0,Cn=()=>{const e=Object.create(null);return e.$math=Object.create(null),e.$math[Fe]=!0,e.$math.PI=new L(-1).acos(),e.$math.E=new L(1).exp(),e.$math.SQRT2=new L(2).sqrt(),e.$math.SQRT1_2=new L(.5).sqrt(),e.$math.LN2=new L(2).ln(),e.$math.LN10=new L(10).ln(),e.$math.LOG2E=e.$math.E.log(2),e.$math.LOG10E=e.$math.E.log(10),e.$math.abs=r=>q(r).abs(),e.$math.sqrt=r=>q(r).sqrt(),e.$math.cbrt=r=>q(r).cbrt(),e.$math.floor=r=>q(r).floor(),e.$math.ceil=r=>q(r).ceil(),e.$math.round=r=>q(r).round(),e.$math.trunc=r=>q(r).trunc(),e.$math.sin=r=>new L(Math.sin(q(r).toNumber())),e.$math.cos=r=>new L(Math.cos(q(r).toNumber())),e.$math.tan=r=>new L(Math.tan(q(r).toNumber())),e.$math.asin=r=>new L(Math.asin(q(r).toNumber())),e.$math.acos=r=>new L(Math.acos(q(r).toNumber())),e.$math.atan=r=>new L(Math.atan(q(r).toNumber())),e.$math.atan2=(r,t)=>new L(Math.atan2(q(r).toNumber(),q(t).toNumber())),e.$math.exp=r=>q(r).exp(),e.$math.ln=r=>q(r).ln(),e.$math.log=r=>q(r).log(),e.$math.log10=r=>q(r).log(10),e.$math.log2=r=>q(r).log(2),e.$math.pow=(r,t)=>q(r).pow(q(t)),e.$math.min=(...r)=>L.min(...r.map(q)),e.$math.max=(...r)=>L.max(...r.map(q)),e.$unit=Object.create(null),e.$unit[Fe]=!0,e.$unit.mmToInch=r=>q(r).div(25.4),e.$unit.inchToMm=r=>q(r).mul(25.4),e.$unit.cmToInch=r=>q(r).div(2.54),e.$unit.inchToCm=r=>q(r).mul(2.54),e.$unit.mToFt=r=>q(r).mul(3.28084),e.$unit.ftToM=r=>q(r).div(3.28084),e.$angle=Object.create(null),e.$angle[Fe]=!0,e.$angle.toRad=r=>q(r).mul(e.$math.PI).div(180),e.$angle.toDeg=r=>q(r).mul(180).div(e.$math.PI),e},Sn=new Set(["prototype","__proto__","constructor"]),Mn=e=>!(Sn.has(e)||e.startsWith("__")),H=async(e,r)=>{switch(e.type){case"Literal":return typeof e.value=="number"?new L(e.raw||e.value):e.value;case"Identifier":if(!(e.name in r))throw new R(`Undefined variable: ${e.name}`);return r[e.name];case"MemberExpression":const t=await H(e.object,r);if(t==null)throw new R(`Cannot access property of ${t}`);let n;if(e.computed){const m=await H(e.property,r);n=String(m)}else n=e.property.name;if(!Mn(n))throw new Te(`Access to property "${n}" is not allowed for security reasons`,n);return t[n];case"BinaryExpression":const i=await H(e.left,r),s=await H(e.right,r);return Pn(e.operator,i,s);case"UnaryExpression":const o=await H(e.argument,r);return xn(e.operator,o);case"CallExpression":const a=await H(e.callee,r),l=[];for(const m of e.arguments)l.push(await H(m,r));if(typeof a!="function")throw new R("Callee is not a function");let c=null;return e.callee.type==="MemberExpression"&&(c=await H(e.callee.object,r)),a.apply(c,l);case"ConditionalExpression":return await H(e.test,r)?await H(e.consequent,r):await H(e.alternate,r);case"LogicalExpression":const w=await H(e.left,r);if(e.operator==="&&")return w&&await H(e.right,r);if(e.operator==="||")return w||await H(e.right,r);if(e.operator==="??")return w??await H(e.right,r);throw new R(`Unsupported logical operator: ${e.operator}`);default:throw new R(`Unsupported node type: ${e.type}`)}},Pn=(e,r,t)=>{if(rt(r)||rt(t))throw new R("Cannot use namespace head in operations - namespace heads must be used with property access (e.g., $math.PI) or method calls (e.g., $math.abs(x))");const n=["+","-","*","/","%","**"],i=["<",">","<=",">="];if(n.includes(e)||i.includes(e)){if(typeof r=="string")throw new R(`Cannot use string in ${e} operation - strings are not supported in mathematical expressions`);if(typeof r=="object"&&r!==null&&!(r instanceof L)&&!Array.isArray(r))throw new R(`Cannot use object in ${e} operation - only numeric values are allowed`);if(Array.isArray(r))throw new R(`Cannot use array in ${e} operation - only numeric values are allowed`);if(typeof t=="string")throw new R(`Cannot use string in ${e} operation - strings are not supported in mathematical expressions`);if(typeof t=="object"&&t!==null&&!(t instanceof L)&&!Array.isArray(t))throw new R(`Cannot use object in ${e} operation - only numeric values are allowed`);if(Array.isArray(t))throw new R(`Cannot use array in ${e} operation - only numeric values are allowed`)}if(e==="=="||e==="="||e==="!="){if(r instanceof L&&t instanceof L){const a=r.eq(t);return e==="!="?!a:a}if(typeof r=="boolean"||r===null||typeof t=="boolean"||t===null){const a=r===t;return e==="!="?!a:a}const o=r==t;return e==="!="?!o:o}const s=o=>o instanceof L?o:new L(o);switch(e){case"+":return s(r).plus(s(t));case"-":return s(r).minus(s(t));case"*":return s(r).times(s(t));case"/":return s(r).div(s(t));case"%":return s(r).mod(s(t));case"**":return s(r).pow(s(t));case"<":return s(r).lt(s(t));case">":return s(r).gt(s(t));case"<=":return s(r).lte(s(t));case">=":return s(r).gte(s(t));default:throw new R(`Unsupported binary operator: ${e}`)}},xn=(e,r)=>{switch(e){case"-":case"+":if(typeof r=="string")throw new R(`Cannot use string with unary ${e} - strings are not supported in mathematical expressions`);if(typeof r=="object"&&r!==null&&!(r instanceof L)&&!Array.isArray(r))throw new R(`Cannot use object with unary ${e} - only numeric values are allowed`);if(Array.isArray(r))throw new R(`Cannot use array with unary ${e} - only numeric values are allowed`);return e==="-"?r instanceof L?r.neg():-r:r instanceof L?r:+r;case"!":return!r;default:throw new R(`Unsupported unary operator: ${e}`)}},On=async(e,r)=>{try{const t=Cn(),n=Object.create(null);for(const[s,o]of Object.entries(r))n[s]=o;for(const[s,o]of Object.entries(t))n[s]=o;const i=await H(e,n);if(rt(i))throw new R("Cannot use namespace head as a value - namespace heads must be used with property access (e.g., $math.PI) or method calls (e.g., $math.abs(x))");if(typeof i=="function")throw new Te("Cannot alias functions - functions must be called with parentheses");if(typeof i=="object"&&i!==null&&!(i instanceof L))throw Array.isArray(i)?new R("Expressions cannot return arrays - arrays must be provided via the value property"):new R("Expressions cannot return objects - objects must be provided via the value property");if(i instanceof L)return i;if(typeof i=="number")return new L(i);if(typeof i=="string"&&!isNaN(Number(i)))return new L(i);if(typeof i=="boolean"||i===null)return i;throw new R(`Unsupported expression result type: ${typeof i}`)}catch(t){throw t instanceof me?t:new Error(`Failed to evaluate expression: ${t instanceof Error?t.message:String(t)}`)}},kn=e=>typeof e!="string"?{valid:!1,error:"Variable name must be a string"}:e===""?{valid:!1,error:"Variable name cannot be empty"}:e.startsWith("$")?{valid:!1,error:"Variable names cannot start with $ (reserved for system namespaces)"}:e.startsWith("__")?{valid:!1,error:"Variable names cannot start with __ (reserved for security reasons)"}:["true","false","null","Infinity"].includes(e)?{valid:!1,error:`Variable name cannot be a reserved value: ${e}`}:/^\d/.test(e)?{valid:!1,error:"Variable names cannot start with a number"}:e.includes(".")?{valid:!1,error:"Variable names cannot contain dots (dots are only for property access in expressions)"}:/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)?{valid:!0}:{valid:!1,error:"Variable name contains invalid characters (only letters, digits, underscore, or $ allowed)"},qn=e=>{if(typeof e!="string")return{valid:!1,error:"Expression must be a string"};const r=e.trim();if(r==="")return{valid:!1,error:"Expression cannot be empty"};try{return Ht(r),{valid:!0}}catch(t){if(t.location){const{line:n,column:i}=t.location.start;return{valid:!1,error:`Parse error at line ${n}, column ${i}: ${t.message}`,line:n,column:i}}return{valid:!1,error:`Parse error: ${t.message||String(t)}`}}},In=async e=>{if(!Array.isArray(e))throw new se("Input must be an array");for(const a of e){if(!a||typeof a!="object")throw new se("Each input must be an object");if(typeof a.name!="string"||!a.name)throw new se('Each input must have a non-empty string "name"');const l=kn(a.name);if(!l.valid)throw new se(`${l.error}: ${a.name}`,a.name);if(!a.expr&&a.value===void 0)throw new se(`Each input must have either "expr" or "value": ${a.name}`,a.name);if(a.expr!==void 0&&typeof a.expr!="string")throw new se(`"expr" must be a string if provided: ${a.name}`,a.name)}const r=new Set;for(const a of e){if(r.has(a.name))throw new se(`Duplicate name: ${a.name}`,a.name);r.add(a.name)}const{order:t,asts:n}=An(e),i=new Map;for(const a of e)a.value!==void 0&&i.set(a.name,a.value);const s=Object.create(null),o=Object.create(null);for(const a of t){let l;if(i.has(a))l=i.get(a);else{const c=n.get(a);if(!c)throw new Error(`No expression or value found for: ${a}`);l=await On(c,o)}l instanceof L||typeof l=="boolean"||l===null?(s[a]=l,o[a]=l):(o[a]=l,typeof l=="number"&&(s[a]=new L(l)))}return{values:s,order:t}};export{it as CircularDependencyError,L as Decimal,me as EvallaError,R as EvaluationError,ge as ParseError,Te as SecurityError,se as ValidationError,qn as checkSyntax,kn as checkVariableName,In as evalla};
